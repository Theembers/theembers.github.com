<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>TheEmbers.devFun</title>
  
  <subtitle>childlike forever. ğŸ˜ƒ</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://theembers.github.io/"/>
  <updated>2020-03-05T03:01:42.370Z</updated>
  <id>https://theembers.github.io/</id>
  
  <author>
    <name>TheEmbers Guo</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>my-house</title>
    <link href="https://theembers.github.io/2020/01/21/my-house/"/>
    <id>https://theembers.github.io/2020/01/21/my-house/</id>
    <published>2020-01-21T07:11:27.000Z</published>
    <updated>2020-03-05T03:01:42.370Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">éœ€è¦å¯†ç æ‰å¯ä»¥çœ‹å“¦.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="a70fb7d0d0c8b5ace92089265c0f2f8b1d79432edd5b87e78192615963f6c3db">bd6095bf6f902e63a54ebf2ca6239355323895d6d4c3ecb461c920c0ebf7643c33c822662e2b4f6da03165e33d355c1974395cd0119379202e6ce6a639b195a10d73c159e430694ca7f869a4ee543171580f6a3f47b656f0c773e1c30c54961ad29badabcf23f45866c58b3310036b3afeb329842dc496b347f5b603726aceb85d338a9a6454af99222df2d61f098bf9123f8135527335ca67c489d2114e2f6e66d31ce45a418bea3349b632f795867d8c752443c2feb30b58d0f9176207bece26a2284df34adcb3565c22f5d50815b5199b10eb9ac83047d5321f0af03e2ec6dc93af005265f898571f6a82cb75eeafe2c77aab9034eeedae32c1616a85c8dbdef17ceb6575b0aa928b8382a5823c92f2e9f2a474d7ce2570b268d70efb0752e9f9fe418565080305997d8f6b4bba659688a0d42a9e8ec32f42729be76ffd4a62e9fa32f72aae121c62b3eb262b328f2a0a13a9ec003b69de97a11e0012f6a8ab0f707e109a1b7532dcfbbb038630d0b79a312699e4bd8c1b34c70841ce048621dca9f289d985dc113c5279fd9338a73b0f5985af19b0508f90d2550340db4edd23e4cc0af2a3a2d6801f61c5b1900d5d4f83f1615a578ce9d73c1e3c25cd0186cb15f128c440a4c9f2856b1a9bb3cb6a31f60082428e60518501423f422b042d47cdb5bd1b0f62739c1388e944903b905fb2a2440b59b8616902728a77fbb8b407a0ba91e032dbac373399aa6ee6f60dcb8643cc360745e3b362568857db355d9bf894add50f5053527dfbc48dcce092669601ef5e57a5dd0310e77777a27e9092d49e79b3db21ee64857d429fabc5ed15ba5c4ddd4c147085259d9c1404ce7daf0905bd35c51c645a685721e4afd89fccd5ce02f67118c57e78faf0c676dae84831a8957b1404c7206abd4725c23a58bbffa7ba00564bac37b600694de3e94a388247226fe8e4d019fc36aed13cde07b1146190d3b92abd7f9f79e97fa1ee0d862afd1b4e3b119c947cacf237893388bbefdc923b9d257af3d1ffd04dc417094165b1c97dee14755d6ee9f0ab77e7d9375a5b01e7d8d3b01b0af3f97ffd93928e181ed98cff52a299c02ac8382197aa451edd5016fec17e13dbf43a8ed65233db6527ea90854c7fb9301613c8da87a6f642d00213cf147305e96199659ac3bf7ebc7800eb150bc12bd332f18ebff6f0c30bc91bea5a8341b3c03ec4e4a4468cccb25098f2b4d45cb1108912953f2e77c7b600645a78b2b7dd917a4469f4e19991b66072100d47acbd71d4be0b537748296bc9981014f2ef2a5938d3de7ab8cddad31a55c963b8ab3027e7df07448542aada080df34f4b02a342ef008e32870dbc8a499c1ac6310d5a89bb6178a52b6274f83f6af5cc21d2baad3ab5d04e07349dd1e0f11737e5a8d793e1d1344f7d2e5e0671dbb585c4ccb63db26d96fdfc68c2cbaf941d4dca64e3f46e0854c9c9586b0361475bbcbba013eeb700ee75f0354e64623532d9c25cd52044e5eaaba30a9c7d5332ec1e470eb026ddad2f12ef75b792f0c5d79e4168b72ef2d5576f7a8f2a16b363f5c352606a9e723bf2fec88ca1644719f5615c4179d54748e38efa456a511e26f855ffe5b7e16e8049d91186b1c6afe2bc74ac5ae7b6bc148dec44d560a943fbf929d49d7655a3fe5bdc5147f6c990e1d235302ccb4394b9621d7b52c84254d65bd3ebce6391370cd58210c77355bd6dfaafad4b5b70b2338644aba3211fbfb28c9588e02268d42d0d37d89125ed09d06d20eaa940c8068b85aec92577032fbd006f2684c72a439668bf53a418bfaf72853f33958c2b95f5ea3327</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      æœ‰ä¸œè¥¿è¢«åŠ å¯†äº†, éœ€è¦å¯†ç æ‰èƒ½çœ‹.
    
    </summary>
    
      <category term="ç¢ç¢å¿µ" scheme="https://theembers.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
      <category term="å®¶è£…" scheme="https://theembers.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/%E5%AE%B6%E8%A3%85/"/>
    
    
      <category term="å®¶è£…" scheme="https://theembers.github.io/tags/%E5%AE%B6%E8%A3%85/"/>
    
  </entry>
  
  <entry>
    <title>java-note[1]-JAVAæºç -çº¿ç¨‹ã€çº¿ç¨‹æ± ã€AQSã€JUC</title>
    <link href="https://theembers.github.io/2020/01/21/java-note-1/"/>
    <id>https://theembers.github.io/2020/01/21/java-note-1/</id>
    <published>2020-01-21T02:46:14.000Z</published>
    <updated>2020-03-05T03:01:42.368Z</updated>
    
    <content type="html"><![CDATA[<h2 id="çº¿ç¨‹ä¸çº¿ç¨‹æ± "><a class="headerlink" href="#çº¿ç¨‹ä¸çº¿ç¨‹æ± "></a> çº¿ç¨‹ä¸çº¿ç¨‹æ± </h2><h3 id="thread"><a class="headerlink" href="#thread"></a> thread</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Threadç±»å®ç°äº†Runnableæ¥å£ï¼Œæ‰€ä»¥è¯´çº¿ç¨‹å¯ä»¥é€šè¿‡ç»§æ‰¿Threadæ¥å®ç°ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> daemon = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">// è¦è¢«æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> Runnable target;</span><br><span class="line">    <span class="comment">// ä¸æœ¬çº¿ç¨‹æœ‰å…³çš„ThreadLocalå€¼ï¼Œè¯¥æ˜ å°„ç”±ThreadLocalç±»ç»´æŠ¤ï¼Œæ³¨æ„è¿™ä¸€ç‚¹ï¼è¿™é‡Œæ˜¯å…³äºThreadLocalä¸ºä»€ä¹ˆä¼šå†…å­˜æ³„æ¼çš„åŸå› ä¹‹ä¸€</span></span><br><span class="line">    ThreadLocal.ThreadLocalMap threadLocals = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="threadlocal"><a class="headerlink" href="#threadlocal"></a> ThreadLocal</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocal</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread t = Thread.currentThread();</span><br><span class="line">        ThreadLocalMap map = getMap(t);</span><br><span class="line">        <span class="keyword">if</span> (map != <span class="keyword">null</span>) &#123;</span><br><span class="line">            ThreadLocalMap.Entry e = map.getEntry(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">                T result = (T)e.value;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> setInitialValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        Thread t = Thread.currentThread();</span><br><span class="line">        ThreadLocalMap map = getMap(t);</span><br><span class="line">        <span class="keyword">if</span> (map != <span class="keyword">null</span>)</span><br><span class="line">            map.set(<span class="keyword">this</span>, value);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            createMap(t, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ThreadLocalMap <span class="title">getMap</span><span class="params">(Thread t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t.threadLocals;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">createMap</span><span class="params">(Thread t, T firstValue)</span> </span>&#123;</span><br><span class="line">        t.threadLocals = <span class="keyword">new</span> ThreadLocalMap(<span class="keyword">this</span>, firstValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * ThreadLocal ç»´æŠ¤åœ¨å®ƒè‡ªå·±å†…éƒ¨ç±»ThreadLocalMapä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªç±»ä¼¼HashMapçš„æ•°æ®ç»“æ„ã€‚</span></span><br><span class="line"><span class="comment">     * å…¶å†…éƒ¨ Entry å¯¹è±¡ç»§æ‰¿äº†å¼±å¼•ç”¨ç±»å‹ WeakReference ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå¯¹è±¡ä¼šåœ¨ä¸‹ä¸€æ¬¡GCæ—¶è¢«å›æ”¶ã€‚æ³¨æ„è¿™é‡Œæ˜¯ThreadLocalä¸ºä»€ä¹ˆä¼šå†…å­˜æ³„æ¼ä¹‹äºŒã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalMap</span> </span>&#123;</span><br><span class="line">        ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123;</span><br><span class="line">            table = <span class="keyword">new</span> Entry[INITIAL_CAPACITY];</span><br><span class="line">            <span class="keyword">int</span> i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - <span class="number">1</span>);</span><br><span class="line">            table[i] = <span class="keyword">new</span> Entry(firstKey, firstValue);</span><br><span class="line">            size = <span class="number">1</span>;</span><br><span class="line">            setThreshold(INITIAL_CAPACITY);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">extends</span> <span class="title">WeakReference</span>&lt;<span class="title">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;</span><br><span class="line">            <span class="comment">/** The value associated with this ThreadLocal. */</span></span><br><span class="line">            Object value;</span><br><span class="line"></span><br><span class="line">            Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">                <span class="keyword">super</span>(k);</span><br><span class="line">                value = v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£å¦‚ä»£ç æ³¨é‡Šå±±æ ‡è®°äº†ä¸¤ä¸ªâ€œæ³¨æ„â€ï¼ŒThreadLocalMapåœ¨Threadä¸­å­˜åœ¨ä¸€ä¸ªå¼ºå¼•ç”¨é“¾ï¼Œè€Œåœ¨ThreadLocalä¸­åˆ™æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨é“¾ã€‚å¦‚æœæ­¤æ—¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‘ç”Ÿäº†GCä¼šå¯¼è‡´å¼±å¼•ç”¨ä¸­çš„Keyå€¼è¢«å›æ”¶ï¼Œè€Œæ­¤æ—¶å½“å‰çº¿ç¨‹å¹¶æ²¡æœ‰åœæ­¢ï¼Œæ‰€ä»¥å¼ºå¼•ç”¨é“¾ä¾æ—§å­˜åœ¨ï¼Œä½†æ˜¯å¹¶ä¸èƒ½é€šè¿‡getæ–¹æ³•è·å–åˆ°valueï¼ˆå› ä¸ºkeyè¢«å›æ”¶å˜æˆäº†nullï¼‰ã€‚æ‰€ä»¥valueä¼šä¸€ç›´å­˜åœ¨äºå†…å­˜ä¸­ï¼ˆå¦‚æœå½“å‰çº¿ç¨‹ä¸€ç›´å­˜æ´»ï¼‰ï¼Œæœ€åå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20200122140356.png" alt></p><h3 id="executorservice-çº¿ç¨‹æ± "><a class="headerlink" href="#executorservice-çº¿ç¨‹æ± "></a> ExecutorService çº¿ç¨‹æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å·¥ä½œé˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> BlockingQueue&lt;Runnable&gt; workQueue;</span><br><span class="line"><span class="comment">// å¯é‡å…¥é”</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"><span class="comment">// å·¥ä½œçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> HashSet&lt;Worker&gt; workers = <span class="keyword">new</span> HashSet&lt;Worker&gt;();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº¿ç¨‹å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * ç»§æ‰¿äº†AQS,è¯´æ˜å®ƒè‡ªç”Ÿæ˜¯å¸¦æœ‰é”æœºåˆ¶çš„ï¼Œä»–æ‰€ä»£è¡¨çš„çº¿ç¨‹çŠ¶æ€ï¼ˆå³workè‡ªå·±çš„çŠ¶æ€ï¼‰éƒ½æ˜¯AQSæœºåˆ¶çš„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Worker</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Thread thread;</span><br><span class="line">    <span class="comment">/** Initial task to run.  Possibly null. */</span></span><br><span class="line">    Runnable firstTask;</span><br><span class="line">    <span class="comment">/** Per-thread task counter */</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">long</span> completedTasks;</span><br><span class="line"></span><br><span class="line">    Worker(Runnable firstTask) &#123;</span><br><span class="line">            setState(-<span class="number">1</span>); <span class="comment">// inhibit interrupts until runWorker AQS åˆå§‹çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">this</span>.firstTask = firstTask;</span><br><span class="line">            <span class="keyword">this</span>.thread = getThreadFactory().newThread(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        runWorker(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å½“å‰æœ‰æ•ˆçš„çº¿ç¨‹æ•° &amp; å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger ctl = <span class="keyword">new</span> AtomicInteger(ctlOf(RUNNING, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (command == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Proceed in 3 steps:</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 1. If fewer than corePoolSize threads are running, try to</span></span><br><span class="line"><span class="comment">         * start a new thread with the given command as its first</span></span><br><span class="line"><span class="comment">         * task.  The call to addWorker atomically checks runState and</span></span><br><span class="line"><span class="comment">         * workerCount, and so prevents false alarms that would add</span></span><br><span class="line"><span class="comment">         * threads when it shouldn't, by returning false.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 2. If a task can be successfully queued, then we still need</span></span><br><span class="line"><span class="comment">         * to double-check whether we should have added a thread</span></span><br><span class="line"><span class="comment">         * (because existing ones died since last checking) or that</span></span><br><span class="line"><span class="comment">         * the pool shut down since entry into this method. So we</span></span><br><span class="line"><span class="comment">         * recheck state and if necessary roll back the enqueuing if</span></span><br><span class="line"><span class="comment">         * stopped, or start a new thread if there are none.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 3. If we cannot queue task, then we try to add a new</span></span><br><span class="line"><span class="comment">         * thread.  If it fails, we know we are shut down or saturated</span></span><br><span class="line"><span class="comment">         * and so reject the task.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="comment">// workerCountOf() è·å–å½“å‰çº¿ç¨‹æ•°,å¦‚æœçº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹ï¼ˆWorkerï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class="line">            <span class="keyword">if</span> (addWorker(command, <span class="keyword">true</span>))</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            c = ctl.get(); <span class="comment">// æ‰§è¡Œåˆ°è¿™é‡Œè¯´æ˜addWorker()æ“ä½œå¤±è´¥ï¼Œæ¯”å¦‚è¢«å…¶ä»–commandæŠ¢å…ˆæ‹‰æ»¡äº†æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// isRunning() è·å–å½“å‰çº¿ç¨‹æ± çŠ¶æ€æ˜¯å¦ä¸ºæ‰§è¡Œä¸­ï¼Œå¹¶ä¸”åŠ å…¥å·¥ä½œé˜Ÿåˆ—æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class="line">            <span class="keyword">int</span> recheck = ctl.get();</span><br><span class="line">            <span class="keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class="line">                <span class="comment">// å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸åœ¨æ‰§è¡ŒçŠ¶æ€ï¼Œä½†æ˜¯ä»»åŠ¡ä»å·¥ä½œé˜Ÿåˆ—ç§»é™¤æˆåŠŸäº†ï¼Œåˆ™è°ƒç”¨æ‹’ç»ç­–ç•¥</span></span><br><span class="line">                reject(command);</span><br><span class="line">            <span class="comment">// å¦‚æœå·¥ä½œçº¿ç¨‹æ€»æ•°ä¸º0ï¼Œå°±åˆ›å»ºæ–°å·¥ä½œçº¿ç¨‹ï¼ˆè‡³å°‘å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ã€‚ï¼‰   </span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>)</span><br><span class="line">                addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="keyword">false</span>)) <span class="comment">// åˆ°è¿™è¯´æ˜é˜Ÿåˆ—æ»¡äº†ï¼Œé‚£ä¹ˆå°±åˆ›å»ºæ‰©å±•çº¿ç¨‹æ‰§è¡Œï¼Œæ³¨æ„addWorker()ç¬¬äºŒä¸ªå‚æ•°ã€‚</span></span><br><span class="line">            <span class="comment">// åˆ°è¿™è¯´æ˜ç”¨æ‹“å±•çº¿ç¨‹ä¹Ÿå¤±è´¥äº†ï¼Œåˆ™è°ƒç”¨æ‹’ç»ç­–ç•¥</span></span><br><span class="line">            reject(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œçº¿ç¨‹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addWorker</span><span class="params">(Runnable firstTask, <span class="keyword">boolean</span> core)</span> </span>&#123;</span><br><span class="line">        retry: <span class="comment">// é‡è¯•ç‚¹</span></span><br><span class="line">        <span class="comment">// CAS æ“ä½œ</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">            <span class="keyword">int</span> rs = runStateOf(c);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check if queue empty only if necessary.</span></span><br><span class="line">            <span class="comment">// æœç„¶ çº¿ç¨‹æ±  åœæ­¢ å¹¶ä¸” æ²¡æœ‰æ–°ä»»åŠ¡ é˜Ÿåˆ—ç©º åˆ™è¿”å› ï¼ˆè¯´ç™½äº†å°±æ˜¯ç°åœºåœæ­¢å¹¶ä¸”å®Œå…¨æ²¡äº‹å¹²äº†ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp; !(rs == SHUTDOWN &amp;&amp; firstTask == <span class="keyword">null</span> &amp;&amp; !workQueue.isEmpty()))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="comment">// è·å–å·¥ä½œçº¿ç¨‹æ•°</span></span><br><span class="line">                <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line">                <span class="comment">// å½“å‰å·¥ä½œçº¿ç¨‹æ•°å¤§äºå®¹é‡ï¼ˆCAPACITY è¡¨ç¤ºçº¿ç¨‹æ± ç†è®ºå®¹é‡ï¼‰æˆ–è€…å¤§äºæ ¸å¿ƒ/æœ€å¤§è®¾ç½®çº¿ç¨‹æ•°æ—¶ è¿”å›</span></span><br><span class="line">                <span class="keyword">if</span> (wc &gt;= CAPACITY ||  wc &gt;= (core ? corePoolSize : maximumPoolSize))</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                <span class="comment">// cas æ·»åŠ çº¿ç¨‹æ•°ã€‚æˆåŠŸ åˆ™è·³å‡ºå¾ªç¯ï¼ˆè·³å‡ºåˆ°æœ€å¤–å±‚å¾ªç¯ï¼‰</span></span><br><span class="line">                <span class="keyword">if</span> (compareAndIncrementWorkerCount(c))</span><br><span class="line">                    <span class="keyword">break</span> retry;</span><br><span class="line">                c = ctl.get();  <span class="comment">// Re-read ctl</span></span><br><span class="line">                <span class="keyword">if</span> (runStateOf(c) != rs) <span class="comment">// cas åˆ¤æ–­å½“å‰çº¿ç¨‹çŠ¶æ€æ˜¯å¦ä¸ä¸Šæ¬¡çš„çŠ¶æ€ä¸€è‡´ï¼Œä¸ä¸€è‡´åˆ™åˆ°æœ€å¤–å±‚é‡è¯•ã€‚</span></span><br><span class="line">                    <span class="keyword">continue</span> retry;</span><br><span class="line">                <span class="comment">// else CAS failed due to workerCount change; retry inner loop</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> workerStarted = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">boolean</span> workerAdded = <span class="keyword">false</span>;</span><br><span class="line">        Worker w = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆå§‹åŒ–ä¸€ä¸ªå·¥ä½œå¯¹è±¡</span></span><br><span class="line">            w = <span class="keyword">new</span> Worker(firstTask);</span><br><span class="line">            <span class="keyword">final</span> Thread t = w.thread;</span><br><span class="line">            <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// ä¸Šé”</span></span><br><span class="line">                <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">                mainLock.lock();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// Recheck while holding lock.</span></span><br><span class="line">                    <span class="comment">// Back out on ThreadFactory failure or if</span></span><br><span class="line">                    <span class="comment">// shut down before lock acquired.</span></span><br><span class="line">                    <span class="keyword">int</span> rs = runStateOf(ctl.get());</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (rs &lt; SHUTDOWN || (rs == SHUTDOWN &amp;&amp; firstTask == <span class="keyword">null</span>)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (t.isAlive()) <span class="comment">// precheck that t is startable</span></span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalThreadStateException();</span><br><span class="line">                        <span class="comment">// æŠŠworkerå¯¹è±¡åŠ åˆ°workersé“¾ä¸­</span></span><br><span class="line">                        workers.add(w);</span><br><span class="line">                        <span class="keyword">int</span> s = workers.size();</span><br><span class="line">                        <span class="keyword">if</span> (s &gt; largestPoolSize)</span><br><span class="line">                            largestPoolSize = s;</span><br><span class="line">                        workerAdded = <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    mainLock.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * å¦‚æœæ·»åŠ æˆåŠŸ é‚£å°±å¼€å§‹è°ƒç”¨ workerçš„start()æ–¹æ³•ï¼Œåç»­è¿™ä¸ªçº¿ç¨‹ä¼šä»å·¥ä½œé˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡è‡ªå·±æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="comment">                 * å¯ä»¥çœ‹Workerçš„runæ–¹æ³•ï¼Œè°ƒç”¨çš„runWorker(Worker this)ï¼Œä»¥åŠ getTask()ä»é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ã€‚</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">if</span> (workerAdded) &#123;</span><br><span class="line">                    t.start();</span><br><span class="line">                    workerStarted = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (! workerStarted)</span><br><span class="line">                addWorkerFailed(w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> workerStarted;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‹’ç»ç­–ç•¥</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">reject</span><span class="params">(Runnable command)</span> </span>&#123;</span><br><span class="line">        handler.rejectedExecution(command, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ç”±æ­¤å¯è§ï¼š</p><ol><li>çº¿ç¨‹æ± åˆå§‹åŒ–çº¿ç¨‹å…¶å®è¶…éº»çƒ¦çš„ï¼Œæ‰€ä»¥åœ¨ä¸€äº›æ ¸å¿ƒåœºæ™¯ä¸‹å¯ä»¥è€ƒè™‘ä¼˜å…ˆåˆå§‹åŒ–çƒ­èº«ï¼ˆæŠŠçº¿ç¨‹æ‹‰æ»¡ï¼‰</li><li>keepAliveTimeæ˜¯è¡¨ç¤º å½“å‰çº¿ç¨‹æ± æœ‰ä»»åŠ¡è¦æ‰§è¡Œï¼Œä½†æ˜¯ç°åœ¨å¼€å¯çš„çº¿ç¨‹æ± å¤ªå¤šäº†ï¼Œå¯¼è‡´ä¸€äº›ç°åœºå§‹ç»ˆæŠ¢ä¸åˆ°ä»»åŠ¡ï¼Œæ‰€ä»¥è¶…è¿‡è¿™ä¸ªæ—¶é—´æ²¡æŠ¢åˆ°ä»»åŠ¡çš„çº¿ç¨‹å°±ä¼šè¢«å›æ”¶</li><li>ä»»åŠ¡è¢«æ‰§è¡Œå®Œåï¼ˆå·¥ä½œé˜Ÿåˆ—æ²¡ä»»åŠ¡äº†ï¼‰ï¼Œåˆ™ä¼šä¸»åŠ¨è°ƒå–processWorkerExit()æ–¹æ³•æ¥å›å‡ºå‘å›æ”¶çº¿ç¨‹æ“ä½œã€‚å¹¶ä¸”ä¼šä¿è¯åªå­˜æ´»æ ¸å¿ƒçº¿ç¨‹æ•°æˆ–è€…åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼ˆONLY_ONEï¼‰</li></ol><p>é™„ä¸Šçº¿ç¨‹æ± å·¥ä½œæµç¨‹å›¾ï¼š</p><center><p><img src="https://i.loli.net/2018/09/06/5b90b431ce0bf.png" alt="çº¿ç¨‹æ± å·¥ä½œæµç¨‹.png"><span class="image-caption">çº¿ç¨‹æ± å·¥ä½œæµç¨‹.png</span></p></center><h2 id="aqs"><a class="headerlink" href="#aqs"></a> AQS</h2><p>AQS -&gt; AbstractQueuedSynchronizer æ˜¯ä¸€ç§å®ç°é”å’Œä»¥æ¥ç­‰å¾…é˜Ÿåˆ—çš„åŒæ­¥å™¨æ¡†æ¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractQueuedSynchronizer</span> <span class="keyword">extends</span> <span class="title">AbstractOwnableSynchronizer</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="comment">/** Marker to indicate a node is waiting in shared mode */</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> Node SHARED = <span class="keyword">new</span> Node();</span><br><span class="line">        <span class="comment">/** Marker to indicate a node is waiting in exclusive mode */</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> Node EXCLUSIVE = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** waitStatus value to indicate thread has cancelled */</span></span><br><span class="line">        <span class="comment">// ç”¨äºæ ‡è®°çº¿ç¨‹è¢«ç»ˆæ­¢çš„çŠ¶æ€å€¼</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CANCELLED =  <span class="number">1</span>;</span><br><span class="line">        <span class="comment">/** waitStatus value to indicate successor's thread needs unparking */</span></span><br><span class="line">        <span class="comment">// ç”¨äºæ ‡è®°çº¿ä¸‹éœ€è¦è¢«å”¤é†’çš„çŠ¶æ€å€¼</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIGNAL    = -<span class="number">1</span>;</span><br><span class="line">        <span class="comment">/** waitStatus value to indicate thread is waiting on condition */</span></span><br><span class="line">        <span class="comment">// ç”¨äºæ ‡è®°çº¿ç¨‹ä¸ºç­‰å¾…çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONDITION = -<span class="number">2</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * waitStatus value to indicate the next acquireShared should</span></span><br><span class="line"><span class="comment">         * unconditionally propagate</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// è¡¨ç¤ºå¯ä»¥ä¼ æ’­ä¸‹ä¸€ä¸ªå…±äº«çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PROPAGATE = -<span class="number">3</span>;</span><br><span class="line">        <span class="comment">// å…±äº«çŠ¶æ€ ä½¿ç”¨ volatile ä¿®é¥° ä¿è¯äº†çŠ¶æ€åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹çš„å¯è§æ€§</span></span><br><span class="line">        <span class="keyword">volatile</span> <span class="keyword">int</span> waitStatus;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Node èŠ‚ç‚¹çš„ä¸¤ç«¯å¼•ç”¨</span></span><br><span class="line">        <span class="keyword">volatile</span> Node prev;</span><br><span class="line">        <span class="keyword">volatile</span> Node next;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“å‰nodeæ’é˜Ÿæ—¶çš„çº¿ç¨‹å®ä¾‹ </span></span><br><span class="line">        <span class="keyword">volatile</span> Thread thread;</span><br><span class="line"></span><br><span class="line">        Node nextWaiter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/UTOOLS1583335209100.png" alt="AQSæ•°æ®æ¨¡å‹"><span class="image-caption">AQSæ•°æ®æ¨¡å‹</span></p><h2 id="juc"><a class="headerlink" href="#juc"></a> JUC</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;çº¿ç¨‹ä¸çº¿ç¨‹æ± &quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#çº¿ç¨‹ä¸çº¿ç¨‹æ± &quot;&gt;&lt;/a&gt; çº¿ç¨‹ä¸çº¿ç¨‹æ± &lt;/h2&gt;
&lt;h3 id=&quot;thread&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#thread&quot;&gt;&lt;/a&gt; thread&lt;/h3&gt;

      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="java" scheme="https://theembers.github.io/categories/dev/java/"/>
    
      <category term="jdk" scheme="https://theembers.github.io/categories/dev/java/jdk/"/>
    
    
      <category term="jdk" scheme="https://theembers.github.io/tags/jdk/"/>
    
      <category term="æºç è§£æ" scheme="https://theembers.github.io/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>java-note[0]-JAVAæºç -åŸºæœ¬ç±»å‹</title>
    <link href="https://theembers.github.io/2020/01/19/java-note-0/"/>
    <id>https://theembers.github.io/2020/01/19/java-note-0/</id>
    <published>2020-01-19T07:50:46.000Z</published>
    <updated>2020-03-05T03:01:42.367Z</updated>
    
    <content type="html"><![CDATA[<h2 id="string-stringbuffer-stringbuilder"><a class="headerlink" href="#string-stringbuffer-stringbuilder"></a> String &amp; StringBuffer &amp; StringBuilder</h2><ul><li><p>String</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ char æ•°ç»„ä½œä¸ºæ•°æ®å­˜å‚¨ï¼ˆåœ¨jdk1.9æ”¹ç”¨byte[]ã€‚ä¼˜åŒ–å­˜å‚¨ç©ºé—´å ç”¨ï¼Œä¸€ä¸ªcharå ç”¨ä¸¤ä¸ªbyteç©ºé—´ï¼‰</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ final ä¿®é¥°ï¼Œè¯´æ˜value[]ä¸å¯å˜ã€‚</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * å¦‚æœæ˜¯é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºå­—ç¬¦ä¸²ç±»å‹ï¼Œé‚£ä¹ˆå€¼æ˜¯é€šè¿‡ä¼ å…¥çš„é­”æ³•å€¼è¿›è¡Œè·å–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰å®ä¾‹çš„valueæ˜¯å¸¸é‡æ± çš„å¼•ç”¨ã€‚</span></span><br><span class="line"><span class="comment"> * æ‰€ä»¥è¯´ ä½¿ç”¨ `new String("123")` è¿™ç§æ–¹å¼ä¼šäº§ç”Ÿä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªåœ¨å¸¸é‡æ± ä¸­ï¼Œä¸€ä¸ªåœ¨å †é‡Œã€‚</span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.value = <span class="string">""</span>.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(String original)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.value = original.value;</span><br><span class="line">    <span class="keyword">this</span>.hash = original.hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>StringBuffer</p><p>ç»§æ‰¿çˆ¶ç±» AbstractStringBuilder value ä¸ String ä¸åŒï¼Œæ˜¯æ²¡æœ‰è¢« final ä¿®é¥°çš„ã€‚æ‰€ä»¥åœ¨è¿ç»­æ‹¼æ¥æ—¶ï¼Œä¸ä¼šåƒ String é‚£æ ·éœ€è¦åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚åœ¨æ•ˆç‡ä¸Šæ›´é«˜ã€‚ï¼ˆæ•ˆç‡æå‡æ¥è‡ªäºçœç•¥äº†å¯¹è±¡å®ä¾‹åŒ–è¿‡ç¨‹ï¼‰</p><p>åˆå§‹ capacity = 16</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> StringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.append(str);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span>[] value;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> AbstractStringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> appendNull();</span><br><span class="line">    <span class="keyword">int</span> len = str.length();</span><br><span class="line">    ensureCapacityInternal(count + len);</span><br><span class="line">    str.getChars(<span class="number">0</span>, len, value, count);</span><br><span class="line">    count += len;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Create a copy, don't share the array</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(value, <span class="number">0</span>, count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>StringBuilder</p><p>ç›¸å¯¹äºStringBuilderï¼Œä»–çš„ä¸€ç³»åˆ—æ–¹æ³•éƒ½ä½¿ç”¨ synchronized è¿›è¡ŒåŠ é”æ§åˆ¶ã€‚<br>ä½¿ç”¨ toStringCache ä½œä¸º toString æ–¹æ³•çš„ç¼“å­˜å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">char</span>[] toStringCache;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> StringBuffer <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    toStringCache = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">super</span>.append(str);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ²¡è¢«ä¿®æ”¹çš„æ—¶å€™, å°±å¯ä»¥ç›´æ¥æŠŠtoStringCacheä½œä¸ºnew Stringçš„å‚æ•°. ç„¶åæŠŠè¿™ä¸ªStringè¿”å›å°±è¡Œäº†ã€‚</span></span><br><span class="line"><span class="comment"> * ä¹Ÿå°±æ˜¯cacheæœ‰æ•ˆçš„æ—¶å€™, å°±ä¸å¿…è¿›è¡Œarraycopyçš„å¤åˆ¶æ“ä½œ. cacheå¤±æ•ˆäº†æ‰è¿›è¡Œarraycopyçš„å¤åˆ¶æ“ä½œã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (toStringCache == <span class="keyword">null</span>) &#123;</span><br><span class="line">        toStringCache = Arrays.copyOfRange(value, <span class="number">0</span>, count);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(toStringCache, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="collection"><a class="headerlink" href="#collection"></a> Collection</h2><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20200120135632.png" alt="javaåŸºæœ¬é›†åˆæ¡†æ¶"><span class="image-caption">javaåŸºæœ¬é›†åˆæ¡†æ¶</span></p><h3 id="list"><a class="headerlink" href="#list"></a> List</h3><h4 id="arraylist"><a class="headerlink" href="#arraylist"></a> ArrayList</h4>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * DEFAULT_CAPACITY ä¸ºé»˜è®¤å®¹é‡ï¼Œä½†æ˜¯åœ¨åˆå§‹åŒ–æ—¶ä½¿ç”¨ EMPTY_ELEMENTDATA æˆ–è€… DEFAULTCAPACITY_EMPTY_ELEMENTDATA è¿›è¡Œåˆå§‹åŒ–ï¼Œ</span></span><br><span class="line"><span class="comment"> * æ‰€ä»¥æ­¤æ—¶çœŸå®å®¹é‡å¤§å°ä¸ºç©ºï¼ˆemptyï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.elementData = <span class="keyword">new</span> Object[initialCapacity];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal Capacity: "</span>+initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ·»åŠ </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“ elementData ä¸ºç©ºæ—¶ æ¯”è¾ƒ minCapacity å’Œ DEFAULT_CAPACITY çš„å€¼ï¼Œå–æœ€å¤§çš„ã€‚</span></span><br><span class="line"><span class="comment"> * ä¹Ÿå°±æ˜¯ï¼Œ æœ‰å€¼çš„æ—¶å€™æœ€å°å®¹é‡ä¸º DEFAULT_CAPACITY = 10</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">calculateCapacity</span><span class="params">(Object[] elementData, <span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> minCapacity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ– åˆå§‹åŒ–å®¹å™¨</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureExplicitCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="comment">// minCapacity (æ‰€éœ€çš„å®¹ç§¯å¤§å°) å¤§äº ç°åœ¨çš„å®¹ç§¯å¤§å°æ—¶è¿›è¡Œæ‰©å®¹ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">        grow(minCapacity);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰©å®¹</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">    <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>); <span class="comment">// æ–°å®¹é‡=è€å®¹é‡+è€å®¹é‡çš„ä¸€åŠ</span></span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    <span class="comment">// å¦‚æœæ‰€éœ€çš„å®¹é‡å¤§äº MAX_ARRAY_SIZE (VM é™åˆ¶çš„ å¤§å° `MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8`)</span></span><br><span class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * å·¨å‹å®¹é‡æ‰©å®¹</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–ä¸º Integer.MAX_VALUE</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hugeCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</span><br><span class="line">    <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="linkedlist"><a class="headerlink" href="#linkedlist"></a> LinkedList</h4>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractSequentialList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">Deque</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br></pre></td></tr></table></figure><p>LinkedList å®ç°äº† List å’Œ Deque æ¥å£ï¼Œæ‰€ä»¥å¯ä»¥ä½œä¸ºåˆ—è¡¨å’ŒåŒç«¯é˜Ÿåˆ—ä½¿ç”¨ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">transient</span> Node&lt;E&gt; first;</span><br><span class="line"><span class="keyword">transient</span> Node&lt;E&gt; last;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* é™æ€å†…éƒ¨ node ç±»</span></span><br><span class="line"><span class="comment">* åŒå‘é“¾è¡¨èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    E item;</span><br><span class="line">    Node&lt;E&gt; next;</span><br><span class="line">    Node&lt;E&gt; prev;</span><br><span class="line">    Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;</span><br><span class="line">        <span class="keyword">this</span>.item = element;</span><br><span class="line">        <span class="keyword">this</span>.next = next;</span><br><span class="line">        <span class="keyword">this</span>.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è·å– å…ƒç´ </span></span><br><span class="line"><span class="comment">* å¦‚æœ index å€¼å°äºé“¾è¡¨é•¿åº¦ size çš„ä¸€åŠï¼Œä»å¤´å¼€å§‹æŸ¥è¯¢ï¼Œå¦åˆ™ä»å°¾å¼€å§‹æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    checkElementIndex(index);</span><br><span class="line">    <span class="keyword">return</span> node(index).item;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Node&lt;E&gt; <span class="title">node</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// assert isElementIndex(index);</span></span><br><span class="line">    <span class="keyword">if</span> (index &lt; (size &gt;&gt; <span class="number">1</span>)) &#123;</span><br><span class="line">        Node&lt;E&gt; x = first;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">            x = x.next;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;E&gt; x = last;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">1</span>; i &gt; index; i--)</span><br><span class="line">            x = x.prev;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ’å…¥ å…ƒç´ </span></span><br><span class="line"><span class="comment">* å…ˆæŸ¥æ‰¾å†æ›¿æ¢ï¼Œå¹¶è¿”å›æ—§å€¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">    checkElementIndex(index);</span><br><span class="line">    Node&lt;E&gt; x = node(index);</span><br><span class="line">    E oldVal = x.item;</span><br><span class="line">    x.item = element;</span><br><span class="line">    <span class="keyword">return</span> oldVal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="vector"><a class="headerlink" href="#vector"></a> Vector</h4><p>ä¸ ArrayList ç›¸ä¼¼ï¼Œä½†æ˜¯ Vector æ˜¯åŒæ­¥çš„(å®ƒçš„publicæ–¹æ³•éƒ½ä½¿ç”¨äº† synchronized ä¿®é¥°)ã€‚æ‰€ä»¥è¯´ Vector æ˜¯çº¿ç¨‹å®‰å…¨çš„åŠ¨æ€æ•°ç»„ã€‚å®ƒçš„æ“ä½œä¸ ArrayList å‡ ä¹ä¸€æ ·ã€‚</p><h4 id="stack"><a class="headerlink" href="#stack"></a> Stack</h4>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Stack ç»§æ‰¿äº† Vector å®ç°ä¸€ä¸ªåè¿›å…ˆå‡ºçš„å †æ ˆã€‚</span></span><br><span class="line"><span class="comment"> * å®ƒçš„ pop() å’Œ peek() æ–¹æ³•ä¹Ÿä½¿ç”¨äº† synchronized ä¿®é¥°</span></span><br><span class="line"><span class="comment"> * push() è°ƒç”¨çˆ¶çº§ Vector çš„ addElement æ–¹æ³• ä¹Ÿæ˜¯åŒæ­¥çš„</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Stack</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Vector</span>&lt;<span class="title">E</span>&gt; </span>&#123;...&#125;</span><br></pre></td></tr></table></figure><h4 id="iterator-æ¥å£-listiterator-æ¥å£"><a class="headerlink" href="#iterator-æ¥å£-listiterator-æ¥å£"></a> Iterator æ¥å£ &amp; ListIterator æ¥å£</h4><p>Iterator æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæ˜¯é›†åˆçš„è¿­ä»£å™¨ã€‚é›†åˆå¯ä»¥é€šè¿‡ Iterator å»éå†é›†åˆä¸­çš„å…ƒç´ ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­é›†åˆé‡Œæ˜¯å¦å­˜åœ¨ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæœ‰ï¼ŒhasNext() æ–¹æ³•è¿”å› true</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// è¿”å›é›†åˆé‡Œä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="function">E <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// åˆ é™¤é›†åˆé‡Œä¸Šä¸€æ¬¡nextæ–¹æ³•è¿”å›çš„å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// å¾ªç¯éå†ï¼ˆsince 1.8ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forEachRemaining</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> E&gt; action)</span></span>;</span><br></pre></td></tr></table></figure><p>ListIterator æ¥å£ç»§æ‰¿ Iterator æ¥å£ï¼Œæä¾›äº†ä¸“é—¨æ“ä½œ List çš„æ–¹æ³•ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­é›†åˆé‡Œæ˜¯å¦å­˜åœ¨ä¸Šä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæœ‰ï¼ŒhasPrevious() æ–¹æ³•è¿”å› true</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">hasPrevious</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// è¿”å›ä¸Šä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="function">E <span class="title">previous</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span></span>;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸¤ä¸ªæ¥å£ç›¸æ¯”è¾ƒä¼šå‘ç°ï¼ŒListIterator å¢åŠ äº†å‘å‰è¿­ä»£çš„åŠŸèƒ½ï¼ˆ Iterator åªèƒ½å‘åè¿­ä»£ï¼‰ï¼ŒListIterator è¿˜å¯ä»¥é€šè¿‡ add() æ–¹æ³•å‘ List é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼ˆIterator åªèƒ½åˆ é™¤å…ƒç´ ï¼‰ã€‚</p><h3 id="queue"><a class="headerlink" href="#queue"></a> Queue</h3><h4 id="linkedlist-2"><a class="headerlink" href="#linkedlist-2"></a> LinkedList</h4><p>å¦‚ä¸Š</p><h4 id="arraydeque"><a class="headerlink" href="#arraydeque"></a> ArrayDeque</h4>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åº•å±‚æ˜¯Objectæ•°ç»„</span></span><br><span class="line"><span class="keyword">transient</span> Object[] elements;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_INITIAL_CAPACITY = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é»˜è®¤åˆå§‹å¤§å°ä¸º16</span></span><br><span class="line"><span class="comment"> * åœ¨å¦‚æœæ˜¯æŒ‡å®šçš„å¤§å°ï¼Œä¼šé€šè¿‡ calculateSize(int numElements) æ–¹æ³•è½¬æ¢ä¸ºå¯¹åº”çš„ 2 çš„æ¬¡æ–¹åŠ 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayDeque</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    elements = <span class="keyword">new</span> Object[<span class="number">16</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayDeque</span><span class="params">(<span class="keyword">int</span> numElements)</span> </span>&#123;</span><br><span class="line">    allocateElements(numElements);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">allocateElements</span><span class="params">(<span class="keyword">int</span> numElements)</span> </span>&#123;</span><br><span class="line">    elements = <span class="keyword">new</span> Object[calculateSize(numElements)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">calculateSize</span><span class="params">(<span class="keyword">int</span> numElements)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> initialCapacity = MIN_INITIAL_CAPACITY;</span><br><span class="line">    <span class="comment">// Find the best power of two to hold elements.</span></span><br><span class="line">    <span class="comment">// Tests "&lt;=" because arrays aren't kept full.</span></span><br><span class="line">    <span class="keyword">if</span> (numElements &gt;= initialCapacity) &#123;</span><br><span class="line">        initialCapacity = numElements;</span><br><span class="line">        initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="number">1</span>);</span><br><span class="line">        initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="number">2</span>);</span><br><span class="line">        initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="number">4</span>);</span><br><span class="line">        initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="number">8</span>);</span><br><span class="line">        initialCapacity |= (initialCapacity &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">        initialCapacity++; <span class="comment">// +1</span></span><br><span class="line">        <span class="comment">// å¦‚æœå…ƒç´ å¤ªå¤§è¶…è¿‡äº† integer çš„æœ€å¤§å€¼ åˆ™ä¼šå˜æˆè´Ÿæ•°</span></span><br><span class="line">        <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)   <span class="comment">// Too many elements, must back off</span></span><br><span class="line">            initialCapacity &gt;&gt;&gt;= <span class="number">1</span>;<span class="comment">// Good luck allocating 2 ^ 30 elements</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> initialCapacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="priorityqueue"><a class="headerlink" href="#priorityqueue"></a> PriorityQueue</h4><p>ä¼˜å…ˆé˜Ÿåˆ—PriorityQueueæ˜¯Queueæ¥å£çš„å®ç°ï¼Œå¯ä»¥å¯¹å…¶ä¸­å…ƒç´ è¿›è¡Œæ’åºï¼Œå¯ä»¥æ”¾åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»ï¼ˆå¦‚ï¼šIntegerï¼ŒLongç­‰ï¼‰æˆ–è‡ªå®šä¹‰çš„ç±»å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…å™¨ç±»ï¼Œä¼˜å…ˆé˜Ÿåˆ—ä¸­å…ƒç´ é»˜è®¤æ’åˆ—é¡ºåºæ˜¯å‡åºæ’åˆ—ä½†å¯¹äºè‡ªå·±å®šä¹‰çš„ç±»æ¥è¯´ï¼Œéœ€è¦è‡ªå·±å®šä¹‰æ¯”è¾ƒå™¨ï¼ˆComparatorï¼‰ã€‚</p><h3 id="set"><a class="headerlink" href="#set"></a> Set</h3><h4 id="hashset"><a class="headerlink" href="#hashset"></a> HashSet</h4>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Set</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="comment">// åº•å±‚ä½¿ç”¨HashMapå­˜å‚¨æ•°æ®ï¼Œæ•°æ®å­˜åœ¨keyéƒ¨åˆ†ï¼ŒHashMapçš„valueéƒ¨åˆ†ä½¿ç”¨PRESENTå¡«å……</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> HashMap&lt;E,Object&gt; map;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Dummy value to associate with an Object in the backing Map</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object PRESENT = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Constructs a new, empty set; the backing &lt;tt&gt;HashMap&lt;/tt&gt; instance has</span></span><br><span class="line"><span class="comment">    * default initial capacity (16) and load factor (0.75).</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä¼ å…¥é›†åˆçš„size/è´Ÿè½½å› å­+1ï¼Œå¦‚æœå°äº16 åˆ™åˆå§‹åŒ–ä¸º16ã€‚</span></span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;&gt;(Math.max((<span class="keyword">int</span>) (c.size()/.<span class="number">75f</span>) + <span class="number">1</span>, <span class="number">16</span>));</span><br><span class="line">        addAll(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¸¦ dummy çš„æ„é€ å‡½æ•°æ˜¯å®ä¾‹åŒ–ä¸€ä¸ªLinkedHashMapä½œä¸ºåº•å±‚æ•°æ®å­˜å‚¨ï¼Œä¸»è¦æ˜¯å®ç°LinkedHashSet</span></span><br><span class="line"><span class="comment">     * dummyåªæ˜¯ä¸ºäº†åŒºåˆ†æ„é€ å‡½æ•°ï¼Œæ²¡æœ‰å®é™…æ„ä¹‰</span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">    &#125;</span><br><span class="line">    HashSet(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor, <span class="keyword">boolean</span> dummy) &#123;</span><br><span class="line">        map = <span class="keyword">new</span> LinkedHashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="treeset-sortedset"><a class="headerlink" href="#treeset-sortedset"></a> TreeSet &amp; SortedSet</h4><p>reeSetæ—¶SortedSetæ¥å£çš„å®ç°ç±»ï¼ŒTreeSetå¯ä»¥ä¿è¯å…ƒç´ å¤„äºæ’åºçŠ¶æ€ï¼Œå®ƒé‡‡ç”¨çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨é›†åˆå…ƒç´ ã€‚<br>TreeSetæ”¯æŒä¸¤ç§æ’åºæ–¹æ³•ï¼šè‡ªç„¶æ’åºå’Œå®šåˆ¶æ’åºï¼Œé»˜è®¤é‡‡ç”¨è‡ªç„¶æ’åºã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NavigableMapæ¥å£ç»§æ‰¿äº†SortedMap</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> NavigableMap&lt;E,Object&gt; m;</span><br></pre></td></tr></table></figure><h2 id="map"><a class="headerlink" href="#map"></a> Map</h2><h3 id="hashmap"><a class="headerlink" href="#hashmap"></a> HashMap</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;, <span class="title">Cloneable</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é»˜è®¤æœ€å°å®¹é‡</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br><span class="line">    <span class="comment">// æœ€å¤§å®¹é‡</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è´Ÿè½½å› å­</span></span><br><span class="line"><span class="comment">     * è¡¨ç¤ºHsahè¡¨ä¸­å…ƒç´ çš„å¡«æ»¡çš„ç¨‹åº¦.è‹¥:åŠ è½½å› å­è¶Šå¤§,å¡«æ»¡çš„å…ƒç´ è¶Šå¤š,å¥½å¤„æ˜¯,ç©ºé—´åˆ©ç”¨ç‡é«˜äº†,ä½†:å†²çªçš„æœºä¼šåŠ å¤§äº†.åä¹‹,åŠ è½½å› å­è¶Šå°,å¡«æ»¡çš„å…ƒç´ è¶Šå°‘,å¥½å¤„æ˜¯:å†²çªçš„æœºä¼šå‡å°äº†,ä½†:ç©ºé—´æµªè´¹å¤šäº†.</span></span><br><span class="line"><span class="comment">     * å†²çªçš„æœºä¼šè¶Šå¤§,åˆ™æŸ¥æ‰¾çš„æˆæœ¬è¶Šé«˜.åä¹‹,æŸ¥æ‰¾çš„æˆæœ¬è¶Šå°.å› è€Œ,æŸ¥æ‰¾æ—¶é—´å°±è¶Šå°. </span></span><br><span class="line"><span class="comment">     * å› æ­¤,å¿…é¡»åœ¨ "å†²çªçš„æœºä¼š"ä¸"ç©ºé—´åˆ©ç”¨ç‡"ä¹‹é—´å¯»æ‰¾ä¸€ç§å¹³è¡¡ä¸æŠ˜è¡·. è¿™ç§å¹³è¡¡ä¸æŠ˜è¡·æœ¬è´¨ä¸Šæ˜¯æ•°æ®ç»“æ„ä¸­æœ‰åçš„"æ—¶-ç©º"çŸ›ç›¾çš„å¹³è¡¡ä¸æŠ˜è¡·.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line">    <span class="comment">// é“¾è¡¨è½¬æ ‘ç»“æ„çš„é˜ˆå€¼</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEIFY_THRESHOLD = <span class="number">8</span>;</span><br><span class="line">    <span class="comment">// æ ‘è½¬é“¾è¡¨çš„é˜ˆå€¼</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNTREEIFY_THRESHOLD = <span class="number">6</span>;</span><br><span class="line">    <span class="comment">// æœ€å°æ ‘å®¹é‡</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_TREEIFY_CAPACITY = <span class="number">64</span>;</span><br><span class="line">    <span class="comment">// ä¸‹ä¸€ä¸ªè¦è°ƒæ•´å¤§å°çš„å¤§å°å€¼ï¼ˆå®¹é‡*è´Ÿè½½ç³»æ•°ï¼‰</span></span><br><span class="line">    <span class="keyword">int</span> threshold;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é™æ€å†…éƒ¨ç±»ï¼Œé“¾è¡¨èŠ‚ç‚¹çš„æ•°æ®ç»“æ„ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    V value;</span><br><span class="line">    Node&lt;K,V&gt; next; <span class="comment">// å•å‘é“¾è¡¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Node é‡å†™äº†hashç®—æ³•ä»¥åŠequalsæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * æ³¨æ„ï¼è¿™é‡Œæ˜¯Nodeå†…éƒ¨ç±»çš„hashï¼Œä¸æ˜¯æŒ‡HashMapçš„hashæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * Objects.hashCode(o) çš„å®ç°æ˜¯å¦‚æœo==nullåˆ™è¿”å›0ï¼Œå¦åˆ™è°ƒç”¨oè‡ªèº«çš„hashCode()æ–¹æ³•çš„è¿”å›å€¼</span></span><br><span class="line"><span class="comment">     * hashCodeä¸equalsçš„é‡å†™ç»å¤§å¤šæ•°æ˜¯åŒæ—¶çš„ï¼Œå› ä¸ºçº¦å®šï¼š</span></span><br><span class="line"><span class="comment">     * equalsç›¸åŒåˆ™hashå€¼ç›¸åŒï¼Œhashç›¸åŒä¸ä¸€å®šequalsã€‚æ­¤å¤„ä¸»è¦æ˜¯å› ä¸ºå‰åŠéƒ¨åˆ†çº¦å®šã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Map.Entry) &#123;</span><br><span class="line">            Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class="line">            <span class="keyword">if</span> (Objects.equals(key, e.getKey()) &amp;&amp; Objects.equals(value, e.getValue()))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HashMapçš„hashç®—æ³•</span></span><br><span class="line"><span class="comment"> * å…³äº hashç®—æ³•çš„çŸ¥è¯†è¡¥å……ï¼š</span></span><br><span class="line"><span class="comment"> * https://www.cnblogs.com/zxporz/p/11204233.html</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œget()å’ŒcontainsKey()æ–¹æ³•éƒ½æ˜¯é€šè¿‡è°ƒç”¨getNode()æ–¹æ³•æ¥è·å–æˆ–åˆ¤æ–­keyçš„å­˜åœ¨çš„ã€‚</span></span><br><span class="line"><span class="comment"> * æ‰€ä»¥å¹³æ—¶ä½¿ç”¨æ—¶è¿™ç§ï¼š</span></span><br><span class="line"><span class="comment"> * if(map.containsKey(key))&#123;</span></span><br><span class="line"><span class="comment"> *    map.get(key);</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> * è¿™ç§ä»£ç å®é™…ä¸Šæ˜¯è¦ä¸¤æ¬¡getNode()çš„ï¼Œæ‰€ä»¥å»ºè®®å–å€¼æ—¶è¿˜æ˜¯ä¸ç”¨é€šè¿‡å’ŒcontainsKey()æ–¹æ³•åˆ¤æ–­äº†ã€‚</span></span><br><span class="line"><span class="comment"> * å¦‚æœæ˜¯è¦åšæœ‰å°±getæ²¡æœ‰å°±putçš„è¯å¯ä»¥å…ˆgetå†åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ˜¯åˆ™putçš„å½¢å¼ã€‚</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">            ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> first; </span><br><span class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœå¤´èŠ‚ç‚¹æ˜¯TreeNodeåˆ™ä½¿ç”¨çº¢é»‘æ ‘çš„ä¾¿åˆ©æ–¹å¼ï¼Œå¦åˆ™ç”¨é“¾è¡¨ä¾¿åˆ©</span></span><br><span class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsKey</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getNode(hash(key), key) != <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mapå®ä¾‹çš„isEmptyæ–¹æ³•åªæ˜¯åˆ¤æ–­sizeæ˜¯ä¸æ˜¯ç­‰äº0ï¼Œåœ¨å¹³æ—¶ä½¿ç”¨æ—¶è¿˜è¦è€ƒè™‘map==nullçš„æƒ…å†µé˜²æ­¢ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Implements Map.put and related methods.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hash</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> onlyIfAbsent å¦‚æœä¸ºtrueï¼Œä¸ä¼šè¦†ç›–å·²æœ‰å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> evict if false, the table is in creation mode.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> è¿”å›æ—§å€¼æˆ–è€…null</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * // ä»¥ä¸‹æ˜¯å…è®¸LinkedHashMapåå¤„ç†çš„å›è°ƒç©ºå®ç°</span></span><br><span class="line"><span class="comment"> * // Callbacks to allow LinkedHashMap post-actions</span></span><br><span class="line"><span class="comment"> * void afterNodeAccess(Node&lt;K,V&gt; p) &#123; &#125;</span></span><br><span class="line"><span class="comment"> * void afterNodeInsertion(boolean evict) &#123; &#125;</span></span><br><span class="line"><span class="comment"> * void afterNodeRemoval(Node&lt;K,V&gt; p) &#123; &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,<span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="comment">// å¦‚æœé“¾é•¿ï¼ˆbinCountï¼‰å¤§äº TREEIFY_THRESHOLD - 1 åˆ™è½¬ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">// å¦‚æœsizeå¤§äºä¸‹ä¸€ä¸ªæ‰©å®¹ç‚¹åˆ™æ‰©å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">    <span class="keyword">int</span> oldThr = threshold;</span><br><span class="line">    <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span> oldTab;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">        newCap = oldThr;</span><br><span class="line">    <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">        newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ? (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    threshold = newThr;</span><br><span class="line">    </span><br><span class="line">    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">    table = newTab;</span><br><span class="line">    <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">            Node&lt;K,V&gt; e;</span><br><span class="line">            <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">                    newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line">                <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line">                    Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; next;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        next = e.next;</span><br><span class="line">                        <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                                loHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                loTail.next = e;</span><br><span class="line">                            loTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                                hiHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                hiTail.next = e;</span><br><span class="line">                            hiTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                        newTab[j] = loHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                        newTab[j + oldCap] = hiHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newTab;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº¢é»‘æ ‘</span></span><br><span class="line"><span class="comment"> * è¾“å…¥æ ‘ç®±ã€‚æ‰©å±•LinkedHashMap.Entryï¼ˆåè¿‡æ¥æ‰©å±•Nodeï¼‰ï¼Œå› æ­¤å¯ä»¥ç”¨ä½œå¸¸è§„èŠ‚ç‚¹æˆ–é“¾æ¥èŠ‚ç‚¹çš„æ‰©å±•ã€‚</span></span><br><span class="line"><span class="comment"> * çº¢é»‘æ ‘ç®—æ³•ï¼š</span></span><br><span class="line"><span class="comment"> * https://segmentfault.com/a/1190000012728513</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">LinkedHashMap</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    TreeNode&lt;K,V&gt; parent;  <span class="comment">// red-black tree links</span></span><br><span class="line">    TreeNode&lt;K,V&gt; left;</span><br><span class="line">    TreeNode&lt;K,V&gt; right;</span><br><span class="line">    TreeNode&lt;K,V&gt; prev;    <span class="comment">// needed to unlink next upon deletion</span></span><br><span class="line">    <span class="keyword">boolean</span> red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="linkedhashmap"><a class="headerlink" href="#linkedhashmap"></a> LinkedHashMap</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedHashMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">HashMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒå‘é“¾è¡¨ç»´æŠ¤keyçš„é¡ºåºã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">HashMap</span>.<span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        Entry&lt;K,V&gt; before, after;</span><br><span class="line">        Entry(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="keyword">super</span>(hash, key, value, next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">transient</span> LinkedHashMap.Entry&lt;K,V&gt; head;</span><br><span class="line"><span class="keyword">transient</span> LinkedHashMap.Entry&lt;K,V&gt; tail;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt;</span></span><br><span class="line"><span class="comment"> * for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order.</span></span><br><span class="line"><span class="comment"> * true è¡¨ç¤ºè®¿é—®é¡ºåº falseè¡¨ç¤ºæ’å…¥é¡ºåº</span></span><br><span class="line"><span class="comment"> * è®¿é—®é¡ºåºæ˜¯åœ¨è°ƒç”¨get()put()ç­‰æ“ä½œæ—¶ä¼šæŠŠè¯¥å…ƒç´ ç§»åˆ°é“¾è¡¨æœ«å°¾ï¼Œä»¥æ­¤å¯ä»¥å®ç°LRUç®—æ³•ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">boolean</span> accessOrder;</span><br></pre></td></tr></table></figure><h3 id="hashtable"><a class="headerlink" href="#hashtable"></a> HashTable</h3><p>æ•°æ®ç»“æ„ä¸HashMapä¸€è‡´ï¼Œæ‰€æœ‰å…¬å…±æ–¹æ³•éƒ½ä½¿ç”¨synchronizedä¿®é¥°ã€‚ä½†å®ƒæ˜¯ä¸€ä¸ªè¢«æŠ›å¼ƒçš„ç±»ï¼Œå®ƒçš„hashç®—æ³•ä»¥åŠé“¾è¡¨çš„ç»“æ„æ²¡æœ‰åƒJDK1.8çš„HashMapé‚£æ ·ä¼˜åŒ–ã€‚</p><h3 id="treemap"><a class="headerlink" href="#treemap"></a> TreeMap</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çœ‹åˆ°NavigableMapå°±åº”è¯¥çŸ¥é“ï¼ŒTreeMapæ˜¯ä¸€ä¸ªè‡ªæ’åºçš„é›†åˆmapå¯¹è±¡ã€‚ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">NavigableMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span>&#123;</span><br><span class="line">  <span class="comment">// é€šè¿‡åˆ¶å®š Comparator è‡ªå®šä¹‰æ’åºè§„åˆ™å¦åˆ™é»˜è®¤ä½¿ç”¨å…ƒç´ ç±»å‹çš„compareTo()æ–¹æ³•è¿›è¡Œæ’åºã€‚</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Comparator&lt;? <span class="keyword">super</span> K&gt; comparator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;string-stringbuffer-stringbuilder&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#string-stringbuffer-stringbuilder&quot;&gt;&lt;/a&gt; String &amp;amp; StringBuffer &amp;a
      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="java" scheme="https://theembers.github.io/categories/dev/java/"/>
    
      <category term="jdk" scheme="https://theembers.github.io/categories/dev/java/jdk/"/>
    
    
      <category term="jdk" scheme="https://theembers.github.io/tags/jdk/"/>
    
      <category term="æºç è§£æ" scheme="https://theembers.github.io/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>spring cloud - å¾®æœåŠ¡æ¶æ„æ ¸å¿ƒå…³é”®ç‚¹</title>
    <link href="https://theembers.github.io/2019/12/11/spring-cloud-0/"/>
    <id>https://theembers.github.io/2019/12/11/spring-cloud-0/</id>
    <published>2019-12-11T01:53:12.000Z</published>
    <updated>2020-03-05T03:01:42.372Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¾®æœåŠ¡æ¶æ„æ ¸å¿ƒå…³é”®ç‚¹"><a class="headerlink" href="#å¾®æœåŠ¡æ¶æ„æ ¸å¿ƒå…³é”®ç‚¹"></a> å¾®æœåŠ¡æ¶æ„æ ¸å¿ƒå…³é”®ç‚¹</h2><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20191211095215.png" alt="å¾®æœåŠ¡æ¶æ„æ ¸å¿ƒå…³é”®ç‚¹"><span class="image-caption">å¾®æœåŠ¡æ¶æ„æ ¸å¿ƒå…³é”®ç‚¹</span></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å¾®æœåŠ¡æ¶æ„æ ¸å¿ƒå…³é”®ç‚¹&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#å¾®æœåŠ¡æ¶æ„æ ¸å¿ƒå…³é”®ç‚¹&quot;&gt;&lt;/a&gt; å¾®æœåŠ¡æ¶æ„æ ¸å¿ƒå…³é”®ç‚¹&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://image-1257148187.cos.ap-chengdu.myqcl
      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="spring cloud" scheme="https://theembers.github.io/categories/dev/spring-cloud/"/>
    
    
  </entry>
  
  <entry>
    <title>redisæ•°æ®åŸºç¡€-æ€ç»´å¯¼å›¾</title>
    <link href="https://theembers.github.io/2019/12/03/redis-0/"/>
    <id>https://theembers.github.io/2019/12/03/redis-0/</id>
    <published>2019-12-03T07:53:39.000Z</published>
    <updated>2020-03-05T03:01:42.371Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20191203164848.jpg" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20191203164848.jpg&quot; alt&gt;&lt;/p&gt;

      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="redis" scheme="https://theembers.github.io/categories/dev/redis/"/>
    
    
      <category term="redis" scheme="https://theembers.github.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Git å¸¸ç”¨å‘½ä»¤ (updating)</title>
    <link href="https://theembers.github.io/2019/11/23/git-help/"/>
    <id>https://theembers.github.io/2019/11/23/git-help/</id>
    <published>2019-11-23T06:30:48.000Z</published>
    <updated>2020-03-05T03:01:42.365Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ä»“åº“"><a class="headerlink" href="#ä»“åº“"></a> ä»“åº“</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨å½“å‰ç›®å½•æ–°å»ºä¸€ä¸ªGitä»£ç åº“</span></span><br><span class="line">$ git init</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œå°†å…¶åˆå§‹åŒ–ä¸ºGitä»£ç åº“</span></span><br><span class="line">$ git init [project-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½ä¸€ä¸ªé¡¹ç›®å’Œå®ƒçš„æ•´ä¸ªä»£ç å†å²</span></span><br><span class="line">$ git <span class="built_in">clone</span> [url]</span><br></pre></td></tr></table></figure><h4 id="é…ç½®"><a class="headerlink" href="#é…ç½®"></a> é…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºå½“å‰çš„Gité…ç½®</span></span><br><span class="line">$ git config --list</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¾‘Gité…ç½®æ–‡ä»¶</span></span><br><span class="line">$ git config -e [--global]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æäº¤ä»£ç æ—¶çš„ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">$ git config [--global] user.name <span class="string">"[name]"</span></span><br><span class="line">$ git config [--global] user.email <span class="string">"[email address]"</span></span><br></pre></td></tr></table></figure><h4 id="å¢åŠ åˆ é™¤æ–‡ä»¶"><a class="headerlink" href="#å¢åŠ åˆ é™¤æ–‡ä»¶"></a> å¢åŠ /åˆ é™¤æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒº</span></span><br><span class="line">$ git add [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æŒ‡å®šç›®å½•åˆ°æš‚å­˜åŒºï¼ŒåŒ…æ‹¬å­ç›®å½•</span></span><br><span class="line">$ git add [dir]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒº</span></span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æ¯ä¸ªå˜åŒ–å‰ï¼Œéƒ½ä¼šè¦æ±‚ç¡®è®¤</span></span><br><span class="line"><span class="comment"># å¯¹äºåŒä¸€ä¸ªæ–‡ä»¶çš„å¤šå¤„å˜åŒ–ï¼Œå¯ä»¥å®ç°åˆ†æ¬¡æäº¤</span></span><br><span class="line">$ git add -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤å·¥ä½œåŒºæ–‡ä»¶ï¼Œå¹¶ä¸”å°†è¿™æ¬¡åˆ é™¤æ”¾å…¥æš‚å­˜åŒº</span></span><br><span class="line">$ git rm [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢è¿½è¸ªæŒ‡å®šæ–‡ä»¶ï¼Œä½†è¯¥æ–‡ä»¶ä¼šä¿ç•™åœ¨å·¥ä½œåŒº</span></span><br><span class="line">$ git rm --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ”¹åæ–‡ä»¶ï¼Œå¹¶ä¸”å°†è¿™ä¸ªæ”¹åæ”¾å…¥æš‚å­˜åŒº</span></span><br><span class="line">$ git mv [file-original] [file-renamed]</span><br></pre></td></tr></table></figure><h4 id="ä»£ç æäº¤"><a class="headerlink" href="#ä»£ç æäº¤"></a> ä»£ç æäº¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æäº¤æš‚å­˜åŒºåˆ°ä»“åº“åŒº</span></span><br><span class="line">$ git commit -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æäº¤æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°ä»“åº“åŒº</span></span><br><span class="line">$ git commit [file1] [file2] ... -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æäº¤å·¥ä½œåŒºè‡ªä¸Šæ¬¡commitä¹‹åçš„å˜åŒ–ï¼Œç›´æ¥åˆ°ä»“åº“åŒº</span></span><br><span class="line">$ git commit -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># æäº¤æ—¶æ˜¾ç¤ºæ‰€æœ‰diffä¿¡æ¯</span></span><br><span class="line">$ git commit -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¸€æ¬¡æ–°çš„commitï¼Œæ›¿ä»£ä¸Šä¸€æ¬¡æäº¤</span></span><br><span class="line"><span class="comment"># å¦‚æœä»£ç æ²¡æœ‰ä»»ä½•æ–°å˜åŒ–ï¼Œåˆ™ç”¨æ¥æ”¹å†™ä¸Šä¸€æ¬¡commitçš„æäº¤ä¿¡æ¯</span></span><br><span class="line">$ git commit --amend -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡åšä¸Šä¸€æ¬¡commitï¼Œå¹¶åŒ…æ‹¬æŒ‡å®šæ–‡ä»¶çš„æ–°å˜åŒ–</span></span><br><span class="line">$ git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure><h4 id="åˆ†æ”¯"><a class="headerlink" href="#åˆ†æ”¯"></a> åˆ†æ”¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯</span></span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯</span></span><br><span class="line">$ git branch -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯</span></span><br><span class="line">$ git branch -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä½†ä¾ç„¶åœç•™åœ¨å½“å‰åˆ†æ”¯</span></span><br><span class="line">$ git branch [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯</span></span><br><span class="line">$ git checkout -b [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼ŒæŒ‡å‘æŒ‡å®šcommit</span></span><br><span class="line">$ git branch [branch] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä¸æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯å»ºç«‹è¿½è¸ªå…³ç³»</span></span><br><span class="line">$ git branch --track [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯ï¼Œå¹¶æ›´æ–°å·¥ä½œåŒº</span></span><br><span class="line">$ git checkout [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªåˆ†æ”¯</span></span><br><span class="line">$ git checkout -</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ºç«‹è¿½è¸ªå…³ç³»ï¼Œåœ¨ç°æœ‰åˆ†æ”¯ä¸æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯ä¹‹é—´</span></span><br><span class="line">$ git branch --<span class="built_in">set</span>-upstream [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯</span></span><br><span class="line">$ git merge [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰æ‹©ä¸€ä¸ªcommitï¼Œåˆå¹¶è¿›å½“å‰åˆ†æ”¯</span></span><br><span class="line">$ git cherry-pick [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤åˆ†æ”¯</span></span><br><span class="line">$ git branch -d [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤è¿œç¨‹åˆ†æ”¯</span></span><br><span class="line">$ git push origin --delete [branch-name]</span><br><span class="line">$ git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure><h4 id="æ ‡ç­¾"><a class="headerlink" href="#æ ‡ç­¾"></a> æ ‡ç­¾</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰tag</span></span><br><span class="line">$ git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªtagåœ¨å½“å‰commit</span></span><br><span class="line">$ git tag [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªtagåœ¨æŒ‡å®šcommit</span></span><br><span class="line">$ git tag [tag] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æœ¬åœ°tag</span></span><br><span class="line">$ git tag -d [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤è¿œç¨‹tag</span></span><br><span class="line">$ git push origin :refs/tags/[tagName]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹tagä¿¡æ¯</span></span><br><span class="line">$ git show [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æäº¤æŒ‡å®štag</span></span><br><span class="line">$ git push [remote] [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æäº¤æ‰€æœ‰tag</span></span><br><span class="line">$ git push [remote] --tags</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼ŒæŒ‡å‘æŸä¸ªtag</span></span><br><span class="line">$ git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹ä¿¡æ¯"><a class="headerlink" href="#æŸ¥çœ‹ä¿¡æ¯"></a> æŸ¥çœ‹ä¿¡æ¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºæœ‰å˜æ›´çš„æ–‡ä»¶</span></span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„ç‰ˆæœ¬å†å²</span></span><br><span class="line">$ git <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºcommitå†å²ï¼Œä»¥åŠæ¯æ¬¡commitå‘ç”Ÿå˜æ›´çš„æ–‡ä»¶</span></span><br><span class="line">$ git <span class="built_in">log</span> --<span class="built_in">stat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢æäº¤å†å²ï¼Œæ ¹æ®å…³é”®è¯</span></span><br><span class="line">$ git <span class="built_in">log</span> -S [keyword]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŸä¸ªcommitä¹‹åçš„æ‰€æœ‰å˜åŠ¨ï¼Œæ¯ä¸ªcommitå æ®ä¸€è¡Œ</span></span><br><span class="line">$ git <span class="built_in">log</span> [tag] HEAD --pretty=format:%s</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŸä¸ªcommitä¹‹åçš„æ‰€æœ‰å˜åŠ¨ï¼Œå…¶"æäº¤è¯´æ˜"å¿…é¡»ç¬¦åˆæœç´¢æ¡ä»¶</span></span><br><span class="line">$ git <span class="built_in">log</span> [tag] HEAD --grep feature</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŸä¸ªæ–‡ä»¶çš„ç‰ˆæœ¬å†å²ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ”¹å</span></span><br><span class="line">$ git <span class="built_in">log</span> --follow [file]</span><br><span class="line">$ git whatchanged [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶ç›¸å…³çš„æ¯ä¸€æ¬¡diff</span></span><br><span class="line">$ git <span class="built_in">log</span> -p [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºè¿‡å»5æ¬¡æäº¤</span></span><br><span class="line">$ git <span class="built_in">log</span> -5 --pretty --oneline</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæ‰€æœ‰æäº¤è¿‡çš„ç”¨æˆ·ï¼ŒæŒ‰æäº¤æ¬¡æ•°æ’åº</span></span><br><span class="line">$ git shortlog -sn</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶æ˜¯ä»€ä¹ˆäººåœ¨ä»€ä¹ˆæ—¶é—´ä¿®æ”¹è¿‡</span></span><br><span class="line">$ git blame [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„å·®å¼‚</span></span><br><span class="line">$ git diff</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæš‚å­˜åŒºå’Œä¸Šä¸€ä¸ªcommitçš„å·®å¼‚</span></span><br><span class="line">$ git diff --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå·¥ä½œåŒºä¸å½“å‰åˆ†æ”¯æœ€æ–°commitä¹‹é—´çš„å·®å¼‚</span></span><br><span class="line">$ git diff HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºä¸¤æ¬¡æäº¤ä¹‹é—´çš„å·®å¼‚</span></span><br><span class="line">$ git diff [first-branch]...[second-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºä»Šå¤©ä½ å†™äº†å¤šå°‘è¡Œä»£ç </span></span><br><span class="line">$ git diff --shortstat <span class="string">"@&#123;0 day ago&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŸæ¬¡æäº¤çš„å…ƒæ•°æ®å’Œå†…å®¹å˜åŒ–</span></span><br><span class="line">$ git show [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŸæ¬¡æäº¤å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶</span></span><br><span class="line">$ git show --name-only [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŸæ¬¡æäº¤æ—¶ï¼ŒæŸä¸ªæ–‡ä»¶çš„å†…å®¹</span></span><br><span class="line">$ git show [commit]:[filename]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„æœ€è¿‘å‡ æ¬¡æäº¤</span></span><br><span class="line">$ git reflog</span><br></pre></td></tr></table></figure><h4 id="è¿œç¨‹åŒæ­¥"><a class="headerlink" href="#è¿œç¨‹åŒæ­¥"></a> è¿œç¨‹åŒæ­¥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½è¿œç¨‹ä»“åº“çš„æ‰€æœ‰å˜åŠ¨</span></span><br><span class="line">$ git fetch [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæ‰€æœ‰è¿œç¨‹ä»“åº“</span></span><br><span class="line">$ git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŸä¸ªè¿œç¨‹ä»“åº“çš„ä¿¡æ¯</span></span><br><span class="line">$ git remote show [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ ä¸€ä¸ªæ–°çš„è¿œç¨‹ä»“åº“ï¼Œå¹¶å‘½å</span></span><br><span class="line">$ git remote add [shortname] [url]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å–å›è¿œç¨‹ä»“åº“çš„å˜åŒ–ï¼Œå¹¶ä¸æœ¬åœ°åˆ†æ”¯åˆå¹¶</span></span><br><span class="line">$ git pull [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šä¼ æœ¬åœ°æŒ‡å®šåˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“</span></span><br><span class="line">$ git push [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼ºè¡Œæ¨é€å½“å‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“ï¼Œå³ä½¿æœ‰å†²çª</span></span><br><span class="line">$ git push [remote] --force</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨é€æ‰€æœ‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“</span></span><br><span class="line">$ git push [remote] --all</span><br></pre></td></tr></table></figure><h4 id="æ’¤é”€"><a class="headerlink" href="#æ’¤é”€"></a> æ’¤é”€</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¢å¤æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°å·¥ä½œåŒº</span></span><br><span class="line">$ git checkout [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¢å¤æŸä¸ªcommitçš„æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒºå’Œå·¥ä½œåŒº</span></span><br><span class="line">$ git checkout [commit] [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¢å¤æš‚å­˜åŒºçš„æ‰€æœ‰æ–‡ä»¶åˆ°å·¥ä½œåŒº</span></span><br><span class="line">$ git checkout .</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡ç½®æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶ï¼Œä¸ä¸Šä¸€æ¬¡commitä¿æŒä¸€è‡´ï¼Œä½†å·¥ä½œåŒºä¸å˜</span></span><br><span class="line">$ git reset [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡ç½®æš‚å­˜åŒºä¸å·¥ä½œåŒºï¼Œä¸ä¸Šä¸€æ¬¡commitä¿æŒä¸€è‡´</span></span><br><span class="line">$ git reset --hard</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡ç½®å½“å‰åˆ†æ”¯çš„æŒ‡é’ˆä¸ºæŒ‡å®šcommitï¼ŒåŒæ—¶é‡ç½®æš‚å­˜åŒºï¼Œä½†å·¥ä½œåŒºä¸å˜</span></span><br><span class="line">$ git reset [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡ç½®å½“å‰åˆ†æ”¯çš„HEADä¸ºæŒ‡å®šcommitï¼ŒåŒæ—¶é‡ç½®æš‚å­˜åŒºå’Œå·¥ä½œåŒºï¼Œä¸æŒ‡å®šcommitä¸€è‡´</span></span><br><span class="line">$ git reset --hard [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡ç½®å½“å‰HEADä¸ºæŒ‡å®šcommitï¼Œä½†ä¿æŒæš‚å­˜åŒºå’Œå·¥ä½œåŒºä¸å˜</span></span><br><span class="line">$ git reset --keep [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªcommitï¼Œç”¨æ¥æ’¤é”€æŒ‡å®šcommit</span></span><br><span class="line"><span class="comment"># åè€…çš„æ‰€æœ‰å˜åŒ–éƒ½å°†è¢«å‰è€…æŠµæ¶ˆï¼Œå¹¶ä¸”åº”ç”¨åˆ°å½“å‰åˆ†æ”¯</span></span><br><span class="line">$ git revert [commit]</span><br><span class="line"></span><br><span class="line">æš‚æ—¶å°†æœªæäº¤çš„å˜åŒ–ç§»é™¤ï¼Œç¨åå†ç§»å…¥</span><br><span class="line">$ git stash</span><br><span class="line">$ git stash pop</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;ä»“åº“&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#ä»“åº“&quot;&gt;&lt;/a&gt; ä»“åº“&lt;/h4&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;lin
      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="git" scheme="https://theembers.github.io/categories/dev/git/"/>
    
    
      <category term="git" scheme="https://theembers.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>IoT æ•°æ®é‡‡é›†æ¡†æ¶ (IoT-DC)</title>
    <link href="https://theembers.github.io/2019/11/18/iot-framework-dc/"/>
    <id>https://theembers.github.io/2019/11/18/iot-framework-dc/</id>
    <published>2019-11-18T09:19:45.000Z</published>
    <updated>2020-03-05T03:01:42.367Z</updated>
    
    <content type="html"><![CDATA[<h2 id="iot-dc-framework"><a class="headerlink" href="#iot-dc-framework"></a> IoT-DC framework</h2><blockquote><p>a IoT data collector framework and power by springboot+netty+rabbitmq/kafka</p><p>ä¸€ä¸ªåŸºäº springboot+netty+rabbitmq å®ç°çš„ ç‰©è”ç½‘è®¾å¤‡(IoT) æ•°æ®æ¥å…¥çš„é¡¹ç›®</p></blockquote><blockquote><p><strong>src</strong>: <a href="https://github.com/Theembers/iot-dc" target="_blank" rel="noopener">https://github.com/Theembers/iot-dc</a></p><p><strong>thanks for star! ğŸ˜ƒ â­â­â­â­â­</strong></p></blockquote><p>the obsolete version (branch:s-0.1) will be not update yet (except bug fix), the master will be rebuild as new one. thanks follow!</p><p>æ—§ç‰ˆæœ¬ä»¥å°ç‰ˆï¼ˆåˆ†æ”¯s-0.1ï¼‰ä¸å†æ›´æ–°ï¼ˆé™¤äº†bugä¿®æ”¹ï¼‰ï¼Œmaster åˆ†æ”¯å°†å¯ç”¨æ–°çš„è®¾è®¡ï¼Œæ•¬è¯·æœŸå¾…ï¼</p><p><a href="https://github.com/Theembers/iot-dc/tree/s-0.1" target="_blank" rel="noopener">branch:s-0.1</a></p><p>ğŸ‰ new framework had be done! you can running with <code>iot-example</code>-<code>me.theembers.iot.TestCollector</code> to debug it.</p><p>ğŸ‰ æ–°ç‰ˆæœ¬æ¡†æ¶å·²åŸºæœ¬å®Œæˆï¼å¯ä»¥é€šè¿‡ <code>iot-example</code>-<code>me.theembers.iot.TestCollector</code> è¿è¡Œè°ƒè¯•ã€‚</p><h2 id="iot-platform-framework-iotå¹³å°æ€»ä½“æ¶æ„è®¾è®¡"><a class="headerlink" href="#iot-platform-framework-iotå¹³å°æ€»ä½“æ¶æ„è®¾è®¡"></a> IoT platform framework (IoTå¹³å°æ€»ä½“æ¶æ„è®¾è®¡)</h2><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190926173357.jpg" alt="è®¾å¤‡æ€»ä½“æ¥å…¥æ¶æ„"><span class="image-caption">è®¾å¤‡æ€»ä½“æ¥å…¥æ¶æ„</span></p><h2 id="about-the-new-iot-dc-framework-å…³äºæ–°ç‰ˆ-iot-dc-framework"><a class="headerlink" href="#about-the-new-iot-dc-framework-å…³äºæ–°ç‰ˆ-iot-dc-framework"></a> about the new IoT-DC Framework (å…³äºæ–°ç‰ˆ IoT-DC Framework)</h2><p>æŠ½ç¦»äº†nettyçš„å®ç°é€»è¾‘ï¼Œä¿ç•™äº†åŸºç¡€æ¡†æ¶</p><ul><li>iot-framework-dc æŠ½è±¡äº†åŸºç¡€çš„æ¥å…¥é€»è¾‘æ¨¡å‹ã€‚å¦‚ä¸‹å›¾ï¼š</li></ul><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20191111134357.jpg" alt="iot-framework-dc æ¨¡å‹"><span class="image-caption">iot-framework-dc æ¨¡å‹</span></p><ul><li><p>router æ¨¡å‹ &amp; device shadow æ¨¡å‹</p><p>è·¯ç”±å™¨ (router)ï¼ŒæŠŠæ¥å…¥çš„æ•°æ®åˆ†å‘åˆ°ç¬¦åˆè§„åˆ™ (rule) çš„å¤„ç†å™¨ (processor) ä¸­è¿›è¡Œå¤„ç†ã€‚<br><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20191111131757.jpg" alt="router æ¨¡å‹"><span class="image-caption">router æ¨¡å‹</span></p></li><li><p>processor-link æ¨¡å‹</p><p>router é€šè¿‡é€‰æ‹©å™¨ (Selector) é€‰æ‹©å‡ºçš„å¯¼èˆª (Route) ç»´æŠ¤äº†ä¸€ä¸ªè°ƒåº¦è€… (Dispatcher) è°ƒåº¦è€…è´Ÿè´£ç®¡ç†è¢«ä½¿ç”¨çš„ processoré“¾ ä»¥åŠ processor çš„è°ƒç”¨ è§„åˆ™:</p></li></ul><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/processor-link-1.jpg" alt="processor-link æ¨¡å‹"><span class="image-caption">processor-link æ¨¡å‹</span></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> * å¦‚æœ å½“å‰processoræ˜¯å¤´èŠ‚ç‚¹ï¼Œè°ƒç”¨ headIn ï¼ˆ è°ƒç”¨ beforeTransform &amp; transFormï¼‰</span></span><br><span class="line"><span class="comment"> * å¦åˆ™ ï¼ˆä¸­é—´èŠ‚ç‚¹ æˆ–è€… å°¾èŠ‚ç‚¹ï¼‰ è°ƒç”¨ receiveï¼ˆæ¥æ”¶ï¼‰</span></span><br><span class="line"><span class="comment"> * æœ€ç»ˆ å¦‚æœ æ˜¯å°¾ç»“ç‚¹ åˆ™ è°ƒç”¨ tailOut ï¼ˆè°ƒç”¨ afterTransformï¼‰ å¹¶ é€€å‡ºå¾ªç¯</span></span><br><span class="line"><span class="comment"> * åˆ° //1 åˆ™ è°ƒç”¨ buildSlotData ï¼ˆæ„å»ºæ’æ§½ï¼‰</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> shadow</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sourceData</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">(Shadow shadow, SourceData sourceData)</span> </span>&#123;</span><br><span class="line">    Output output = <span class="keyword">null</span>;</span><br><span class="line">    SlotData slotData = <span class="keyword">null</span>;</span><br><span class="line">    Iterator&lt;Processor&gt; processors = <span class="keyword">this</span>.link.iterator();</span><br><span class="line">    <span class="keyword">while</span> (processors.hasNext()) &#123;</span><br><span class="line">        Processor p = processors.next();</span><br><span class="line">        <span class="keyword">if</span> (p == getFirst()) &#123;</span><br><span class="line">            output = p.headIn(shadow, sourceData);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            output = p.receive(shadow, slotData);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (p == getLast()) &#123;</span><br><span class="line">            output = p.tailOut(shadow, output);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        slotData = p.passOn(shadow, output); <span class="comment">// 1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>iot-dc-netty-server æ˜¯ä¹‹å‰çš„nettyå®ç°ï¼Œç›®å‰ï¼ˆ2019-11-07ï¼‰åªæ˜¯è¿ç§»äº†è€æ¨¡å—çš„ä»£ç ï¼ŒåæœŸä¼šä¿®æ”¹ç»“æ„ï¼Œæ‰€ä»¥æš‚ä¸åšæ¶æ„è¯´æ˜ã€‚æ–°åˆ†æ”¯ä¾§ç€æ¶æ„è®¾è®¡ï¼Œæ‰€ä»¥å…·ä½“å®ç°å¯èƒ½è¦å»¶åå®ç°ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;iot-dc-framework&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#iot-dc-framework&quot;&gt;&lt;/a&gt; IoT-DC framework&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;a IoT data collector fra
      
    
    </summary>
    
      <category term="iot" scheme="https://theembers.github.io/categories/iot/"/>
    
    
      <category term="iot" scheme="https://theembers.github.io/tags/iot/"/>
    
      <category term="framework" scheme="https://theembers.github.io/tags/framework/"/>
    
  </entry>
  
  <entry>
    <title>é¢†åŸŸæ¨¡å‹é©±åŠ¨è®¾è®¡[0]</title>
    <link href="https://theembers.github.io/2019/11/01/Domain-Driven-Design-0/"/>
    <id>https://theembers.github.io/2019/11/01/Domain-Driven-Design-0/</id>
    <published>2019-11-01T02:07:59.000Z</published>
    <updated>2020-03-05T03:01:42.358Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>æ¨¡å‹å’Œè®¾è®¡çš„æ ¸å¿ƒï¼ˆå®ç°ï¼‰äº’ç›¸å½±å“<br>è®¾è®¡çš„æ ¸å¿ƒå°±æ˜¯å¯¹ä¸ç°å®ä¸šåŠ¡éœ€æ±‚çš„å®ç°ï¼Œè€Œå®ç°éœ€æ±‚çš„é€»è¾‘åˆ™æ˜¯æ¨¡å‹çš„å®šä¹‰ã€‚<br>å®ç°ä½¿å¾—æ¨¡å‹æœ‰ç”¨ï¼Œè€Œæ¨¡å‹å¯è§£é‡Šå®ç°ã€‚</p></li><li><p>æ¨¡å‹æ˜¯å›¢é˜Ÿäº¤æµä¸­æ¢<br>è¯­ä¹‰ç»Ÿä¸€ï¼Œå‡å°‘æ²Ÿé€šåå·®å’Œæˆæœ¬ã€‚</p></li><li><p>æ¨¡å‹æµ“ç¼©çŸ¥è¯†</p></li></ul><h2 id="dddä¸­çš„åŸºæœ¬æ¦‚å¿µ"><a class="headerlink" href="#dddä¸­çš„åŸºæœ¬æ¦‚å¿µ"></a> DDDä¸­çš„åŸºæœ¬æ¦‚å¿µ</h2><ul><li><p>å®ä½“ï¼ˆEntityï¼‰<br>å½“ä¸€ä¸ªå¯¹è±¡ç”±å…¶æ ‡è¯†(è€Œä¸æ˜¯å±æ€§)åŒºåˆ†æ—¶ï¼Œè¿™ç§å¯¹è±¡ç§°ä¸ºå®ä½“(Entity)ã€‚æ¯”å¦‚å½“ä¸¤ä¸ªå¯¹è±¡çš„æ ‡è¯†ä¸åŒæ—¶ï¼Œå³ä½¿ä¸¤ä¸ªå¯¹è±¡çš„å…¶ä»–å±æ€§å…¨éƒ½ç›¸åŒï¼Œæˆ‘ä»¬ä¹Ÿè®¤ä¸ºä»–ä»¬æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„å®ä½“ã€‚</p></li><li><p>å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰<br>å½“ä¸€ä¸ªå¯¹è±¡ç”¨äºå¯¹äº‹ç‰©è¿›è¡Œæè¿°è€Œæ²¡æœ‰å”¯ä¸€æ ‡è¯†æ—¶ï¼Œé‚£ä¹ˆå®ƒè¢«ç§°ä½œå€¼å¯¹è±¡ã€‚å› ä¸ºåœ¨é¢†åŸŸä¸­å¹¶ä¸æ˜¯ä»»ä½•æ—¶å€™ä¸€ä¸ªäº‹ç‰©éƒ½éœ€è¦æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¹¶ä¸å…³å¿ƒå…·ä½“æ˜¯å“ªä¸ªäº‹ç‰©ï¼Œåªå…³å¿ƒè¿™ä¸ªäº‹ç‰©æ˜¯ä»€ä¹ˆã€‚æ¯”å¦‚ä¸‹å•æµç¨‹ä¸­ï¼Œå¯¹äºé…é€åœ°å€æ¥è¯´ï¼Œåªè¦æ˜¯åœ°å€ä¿¡æ¯ç›¸åŒï¼Œæˆ‘ä»¬å°±è®¤ä¸ºæ˜¯åŒä¸€ä¸ªé…é€åœ°å€ã€‚ç”±äºä¸å…·æœ‰å”¯ä¸€æ ‡ç¤ºï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½è¯´&quot;è¿™ä¸€ä¸ª&quot;å€¼å¯¹è±¡æˆ–è€…&quot;é‚£ä¸€ä¸ª&quot;å€¼å¯¹è±¡ã€‚</p></li><li><p>é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰<br>ä¸€äº›é‡è¦çš„é¢†åŸŸè¡Œä¸ºæˆ–æ“ä½œï¼Œå®ƒä»¬ä¸å¤ªé€‚åˆå»ºæ¨¡ä¸ºå®ä½“å¯¹è±¡æˆ–è€…å€¼å¯¹è±¡ï¼Œå®ƒä»¬æœ¬è´¨ä¸Šåªæ˜¯ä¸€äº›æ“ä½œï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„äº‹ç‰©ï¼Œå¦ä¸€æ–¹é¢è¿™äº›æ“ä½œå¾€å¾€åˆä¼šæ¶‰åŠåˆ°å¤šä¸ªé¢†åŸŸå¯¹è±¡çš„æ“ä½œï¼Œå®ƒä»¬åªè´Ÿè´£æ¥åè°ƒè¿™äº›é¢†åŸŸå¯¹è±¡å®Œæˆæ“ä½œè€Œå·²ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å½’ç±»å®ƒä»¬ä¸ºé¢†åŸŸæœåŠ¡ã€‚å®ƒå®ç°äº†å…¨éƒ¨ä¸šåŠ¡é€»è¾‘å¹¶ä¸”é€šè¿‡å„ç§æ ¡éªŒæ‰‹æ®µä¿è¯ä¸šåŠ¡çš„æ­£ç¡®æ€§ã€‚åŒæ—¶å‘¢ï¼Œå®ƒä¹Ÿèƒ½é¿å…åœ¨åº”ç”¨å±‚å‡ºç°é¢†åŸŸé€»è¾‘ã€‚ç†è§£èµ·æ¥ï¼Œé¢†åŸŸæœåŠ¡æœ‰ç‚¹facadeçš„å‘³é“ã€‚</p></li><li><p>èšåˆåŠèšåˆæ ¹ï¼ˆAggregateï¼ŒAggregate Rootï¼‰<br>èšåˆæ˜¯é€šè¿‡å®šä¹‰é¢†åŸŸå¯¹è±¡ä¹‹é—´æ¸…æ™°çš„æ‰€å±å…³ç³»ä»¥åŠè¾¹ç•Œæ¥å®ç°é¢†åŸŸæ¨¡å‹çš„å†…èšï¼Œä»¥æ­¤æ¥é¿å…å½¢æˆé”™ç»¼å¤æ‚çš„ã€éš¾ä»¥ç»´æŠ¤çš„å¯¹è±¡å…³ç³»ç½‘ã€‚èšåˆå®šä¹‰äº†ä¸€ç»„å…·æœ‰å†…èšå…³ç³»çš„ç›¸å…³é¢†åŸŸå¯¹è±¡çš„é›†åˆï¼Œæˆ‘ä»¬å¯ä»¥æŠŠèšåˆçœ‹ä½œæ˜¯ä¸€ä¸ªä¿®æ”¹æ•°æ®çš„å•å…ƒã€‚<br>èšåˆæ ¹å±äºå®ä½“å¯¹è±¡ï¼Œå®ƒæ˜¯é¢†åŸŸå¯¹è±¡ä¸­ä¸€ä¸ªé«˜åº¦å†…èšçš„æ ¸å¿ƒå¯¹è±¡ã€‚(èšåˆæ ¹å…·æœ‰å…¨å±€çš„å”¯ä¸€æ ‡è¯†ï¼Œè€Œå®ä½“åªæœ‰åœ¨èšåˆå†…éƒ¨æœ‰å”¯ä¸€çš„æœ¬åœ°æ ‡è¯†ï¼Œå€¼å¯¹è±¡æ²¡æœ‰å”¯ä¸€æ ‡è¯†ï¼Œä¸å­˜åœ¨è¿™ä¸ªå€¼å¯¹è±¡æˆ–é‚£ä¸ªå€¼å¯¹è±¡çš„è¯´æ³•)<br>è‹¥ä¸€ä¸ªèšåˆä»…æœ‰ä¸€ä¸ªå®ä½“ï¼Œé‚£è¿™ä¸ªå®ä½“å°±æ˜¯èšåˆæ ¹ï¼›ä½†è¦æœ‰å¤šä¸ªå®ä½“ï¼Œæˆ‘ä»¬å°±è¦æ€è€ƒèšåˆå†…å“ªä¸ªå¯¹è±¡æœ‰ç‹¬ç«‹å­˜åœ¨çš„æ„ä¹‰ä¸”å¯ä»¥å’Œå¤–éƒ¨é¢†åŸŸç›´æ¥è¿›è¡Œäº¤äº’ã€‚</p></li><li><p>å·¥å‚ï¼ˆFactoryï¼‰<br>DDDä¸­çš„å·¥å‚ä¹Ÿæ˜¯ä¸€ç§å°è£…æ€æƒ³çš„ä½“ç°ã€‚å¼•å…¥å·¥å‚çš„åŸå› æ˜¯ï¼šæœ‰æ—¶åˆ›å»ºä¸€ä¸ªé¢†åŸŸå¯¹è±¡æ˜¯ä¸€ä»¶ç›¸å¯¹æ¯”è¾ƒå¤æ‚çš„äº‹æƒ…ï¼Œè€Œä¸æ˜¯ç®€å•çš„newæ“ä½œã€‚å·¥å‚çš„ä½œç”¨æ˜¯éšè—åˆ›å»ºå¯¹è±¡çš„ç»†èŠ‚ã€‚äº‹å®ä¸Šå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œé¢†åŸŸå¯¹è±¡çš„åˆ›å»ºéƒ½ä¸ä¼šç›¸å¯¹å¤ªå¤æ‚ï¼Œæ•…æˆ‘ä»¬ä»…éœ€ä½¿ç”¨ç®€å•çš„æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡å°±å¯ä»¥ã€‚éšè—åˆ›å»ºå¯¹è±¡ç»†èŠ‚çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œè¿™æ ·å°±å¯ä»¥ä¸ä¼šè®©é¢†åŸŸå±‚çš„ä¸šåŠ¡é€»è¾‘æ³„éœ²åˆ°åº”ç”¨å±‚ï¼ŒåŒæ—¶ä¹Ÿå‡è½»åº”ç”¨å±‚è´Ÿæ‹…ï¼Œå®ƒåªè¦ç®€å•è°ƒç”¨é¢†åŸŸå·¥å‚æ¥åˆ›å»ºå‡ºæœŸæœ›çš„å¯¹è±¡å°±å¯ä»¥äº†ã€‚</p></li><li><p>ä»“å‚¨ï¼ˆRepositoryï¼‰<br>èµ„æºä»“å‚¨å°è£…äº†åŸºç¡€è®¾æ–½æ¥æä¾›æŸ¥è¯¢å’ŒæŒä¹…åŒ–èšåˆæ“ä½œã€‚è¿™æ ·èƒ½å¤Ÿè®©æˆ‘ä»¬å§‹ç»ˆå…³æ³¨åœ¨æ¨¡å‹å±‚é¢ï¼ŒæŠŠå¯¹è±¡çš„å­˜å‚¨å’Œè®¿é—®éƒ½å§”æ‰˜ç»™èµ„æºåº“æ¥å®Œæˆã€‚å®ƒä¸æ˜¯æ•°æ®åº“çš„å°è£…ï¼Œè€Œæ˜¯é¢†åŸŸå±‚ä¸åŸºç¡€è®¾æ–½ä¹‹é—´çš„æ¡¥æ¢ã€‚DDD å…³å¿ƒçš„æ˜¯é¢†åŸŸå†…çš„æ¨¡å‹ï¼Œè€Œä¸æ˜¯æ•°æ®åº“çš„æ“ä½œã€‚</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ¨¡å‹å’Œè®¾è®¡çš„æ ¸å¿ƒï¼ˆå®ç°ï¼‰äº’ç›¸å½±å“&lt;br&gt;
è®¾è®¡çš„æ ¸å¿ƒå°±æ˜¯å¯¹ä¸ç°å®ä¸šåŠ¡éœ€æ±‚çš„å®ç°ï¼Œè€Œå®ç°éœ€æ±‚çš„é€»è¾‘åˆ™æ˜¯æ¨¡å‹çš„å®šä¹‰ã€‚&lt;br&gt;
å®ç°ä½¿å¾—æ¨¡å‹æœ‰ç”¨ï¼Œè€Œæ¨¡å‹å¯è§£é‡Šå®ç°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¨¡å‹æ˜¯å›¢é˜Ÿäº¤æµä¸­æ¢&lt;br&gt;
è¯­ä¹‰ç»Ÿä¸€ï¼Œå‡å°‘æ²Ÿé€šåå·®å’Œæˆæœ¬ã€‚
      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="DDD" scheme="https://theembers.github.io/categories/dev/DDD/"/>
    
    
  </entry>
  
  <entry>
    <title>spring-cloud-bus-config æ¶ˆæ¯æ€»çº¿&amp;é…ç½®ä¸­å¿ƒ</title>
    <link href="https://theembers.github.io/2019/10/12/spring-cloud-bus-config/"/>
    <id>https://theembers.github.io/2019/10/12/spring-cloud-bus-config/</id>
    <published>2019-10-12T01:56:07.000Z</published>
    <updated>2020-03-05T02:50:57.391Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åœºæ™¯æ„ä¹‰"><a class="headerlink" href="#åœºæ™¯æ„ä¹‰"></a> åœºæ™¯&amp;æ„ä¹‰</h2><p>åœ¨ä¸é‡å¯æœåŠ¡çš„æƒ…å†µä¸‹æ›´æ–°é…ç½®ï¼Œä½†é€ä¸€è°ƒç”¨æœåŠ¡çš„apiå»ä¿®æ”¹æ˜¯å¾ˆä¸ç§‘å­¦çš„ã€‚æ‰€ä»¥å¯ä»¥åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—å‘å¸ƒè®¢é˜…çš„æ¨¡å‹ï¼Œè®©æ‰€æœ‰ä¸ºæœåŠ¡æ¥è®¢é˜…è¿™ä¸ªäº‹ä»¶ï¼Œå½“è¿™ä¸ªäº‹ä»¶å‘ç”Ÿæ”¹å˜äº†ï¼Œå°±å¯ä»¥é€šçŸ¥æ‰€æœ‰å¾®æœåŠ¡å»æ›´æ–°å®ƒä»¬çš„å†…å­˜ä¸­çš„é…ç½®ä¿¡æ¯ã€‚</p><p>spring-cloud-bus æ¶ˆæ¯æ€»çº¿å°±å°±æ˜¯åœ¨spring-cloud-config-serverç«¯å‘å‡ºrefreshï¼Œè§¦å‘æ‰€æœ‰å¾®æœåŠ¡æ›´æ–°é…ç½®ã€‚</p><h2 id="æ­å»ºdemoé¡¹ç›®"><a class="headerlink" href="#æ­å»ºdemoé¡¹ç›®"></a> æ­å»ºdemoé¡¹ç›®</h2><ul><li>spring cloud<ul><li>eureka</li><li>config-bus (é›†æˆäº†config é…ç½®ä¸­å¿ƒ &amp; bus æ¶ˆæ¯æ€»çº¿)</li><li>web-api</li></ul></li></ul><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20191016130547.png" alt="demoé¡¹ç›®ç»“æ„è¯´æ˜"><span class="image-caption">demoé¡¹ç›®ç»“æ„è¯´æ˜</span></p><h2 id="æ›´æ–°é…ç½®åŠ è½½"><a class="headerlink" href="#æ›´æ–°é…ç½®åŠ è½½"></a> æ›´æ–°é…ç½®&amp;åŠ è½½</h2><ol><li>commit&amp;push gité…ç½® åˆ°gitæœåŠ¡å™¨</li><li>è°ƒç”¨refreshæ¥å£åˆ·æ–°æœåŠ¡å™¨é…ç½®</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># springboot 2.x</span></span><br><span class="line"> curl -X POST <span class="string">"192.168.9.97:8868/actuator/bus-refresh"</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># springboot 1.x</span></span><br><span class="line"> curl -X GET <span class="string">"192.168.9.97:8868/bus/refresh"</span></span><br></pre></td></tr></table></figure><h2 id="ç°åº¦æ›´æ–°"><a class="headerlink" href="#ç°åº¦æ›´æ–°"></a> ç°åº¦æ›´æ–°</h2><p>ç°åº¦æ›´æ–°æ˜¯ä¸ºäº†åœ¨å¤šèŠ‚ç‚¹é›†ç¾¤ä¸­ï¼Œåªæ›´æ–°éƒ¨åˆ†æœåŠ¡çš„é…ç½®ç”¨äºå‚æ•°æµ‹è¯•ï¼Œè€Œå…¶ä»–æœåŠ¡ä¾æ—§ä½¿ç”¨ä¹‹å‰çš„é…ç½®ã€‚<br>spring cloud bus é€šè¿‡ destination å‚æ•°æŒ‡å®šéœ€è¦æ›´æ–°å¯¹æœåŠ¡æ¥åˆ·æ–°é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># springboot 2.X</span></span><br><span class="line">curl -X POST <span class="string">"192.168.9.97:8868/actuator/bus-refresh/&#123;destination&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#springboot 1.X</span></span><br><span class="line">curl -X GET <span class="string">"192.168.9.97:8868/bus/refresh?destination=&#123;ApplicationContext ID&#125;"</span></span><br></pre></td></tr></table></figure><p>destination å‚æ•°ä¸º ApplicationContext ID ä¾‹å¦‚æœ¬ä¾‹ä¸­çš„ <code>api-gateway:8869</code> æˆ–è€… <code>api-gateway:**</code></p><h2 id="é€šè¿‡é…ç½®-git-ä»“åº“-webhooks-æ¥è‡ªåŠ¨è°ƒç”¨æ¥å£"><a class="headerlink" href="#é€šè¿‡é…ç½®-git-ä»“åº“-webhooks-æ¥è‡ªåŠ¨è°ƒç”¨æ¥å£"></a> é€šè¿‡é…ç½® Git ä»“åº“ WebHooks æ¥è‡ªåŠ¨è°ƒç”¨æ¥å£</h2><p>git é…ç½®ä¿®æ”¹åè‡ªåŠ¨å›è°ƒã€‚</p><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20191016133403.png" alt="git å›è°ƒé…ç½®"><span class="image-caption">git å›è°ƒé…ç½®</span></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;åœºæ™¯æ„ä¹‰&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#åœºæ™¯æ„ä¹‰&quot;&gt;&lt;/a&gt; åœºæ™¯&amp;amp;æ„ä¹‰&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸é‡å¯æœåŠ¡çš„æƒ…å†µä¸‹æ›´æ–°é…ç½®ï¼Œä½†é€ä¸€è°ƒç”¨æœåŠ¡çš„apiå»ä¿®æ”¹æ˜¯å¾ˆä¸ç§‘å­¦çš„ã€‚æ‰€ä»¥å¯ä»¥åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—å‘å¸ƒè®¢é˜…çš„æ¨¡å‹ï¼Œè®©æ‰€æœ‰ä¸ºæœåŠ¡æ¥è®¢é˜…è¿™ä¸ªäº‹ä»¶ï¼Œ
      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="spring cloud" scheme="https://theembers.github.io/categories/dev/spring-cloud/"/>
    
    
      <category term="spring-cloud-bus" scheme="https://theembers.github.io/tags/spring-cloud-bus/"/>
    
      <category term="spring-cloud-config" scheme="https://theembers.github.io/tags/spring-cloud-config/"/>
    
  </entry>
  
  <entry>
    <title>å°é›ªç¬¬ä¸‰é˜¶æ®µ-ç”Ÿæ—¥å¿«ä¹~ãƒ½(=^ï½¥Ï‰ï½¥^=)</title>
    <link href="https://theembers.github.io/2019/10/05/cat-in-the-house-2/"/>
    <id>https://theembers.github.io/2019/10/05/cat-in-the-house-2/</id>
    <published>2019-10-05T02:59:59.000Z</published>
    <updated>2020-03-05T03:01:42.361Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20191012170551.jpg" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20191012170551.jpg&quot; alt&gt;&lt;/p&gt;

      
    
    </summary>
    
      <category term="blog" scheme="https://theembers.github.io/categories/blog/"/>
    
      <category term="ç¢ç¢å¿µ" scheme="https://theembers.github.io/categories/blog/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
      <category term="cat" scheme="https://theembers.github.io/tags/cat/"/>
    
      <category term="é›ªç³•" scheme="https://theembers.github.io/tags/%E9%9B%AA%E7%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>spring cloud health - å¦‚ä½•å®ç°è§„èŒƒçš„è‡ªå®šä¹‰å¥åº·æ£€æŸ¥æŒ‡æ ‡</title>
    <link href="https://theembers.github.io/2019/08/12/spring-cloud-health-1/"/>
    <id>https://theembers.github.io/2019/08/12/spring-cloud-health-1/</id>
    <published>2019-08-12T02:33:17.000Z</published>
    <updated>2020-03-05T03:01:42.373Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•"><a class="headerlink" href="#å¼•"></a> å¼•</h2><p>Spring Boot Actuator æœ‰å‡ ä¸ªé¢„å®šä¹‰çš„å¥åº·æŒ‡æ ‡æ¯”å¦‚ DataSourceHealthIndicator, DiskSpaceHealthIndicator, MongoHealthIndicator, RedisHealthIndicator, CassandraHealthIndicatorç­‰ã€‚å®ƒä½¿ç”¨è¿™äº›å¥åº·æŒ‡æ ‡ä½œä¸ºå¥åº·æ£€æŸ¥çš„ä¸€éƒ¨åˆ†ã€‚</p><p>æœ¬æ–‡å¯¹æ¯”è¾ƒå¸¸ç”¨æ•°æ®æºå¥åº·æŒ‡æ ‡ DataSourceHealth ç›¸å…³çš„æºç è¿›è¡Œç ”ç©¶è§£è¯»ï¼Œä»¥æ­¤ä½œä¸ºè‡ªå®šä¹‰ HealthIndicator çš„ç¼–ç¨‹åŸºç¡€ã€‚å·²å®ç°è§„èŒƒçš„HealthIndicatorç¼–ç¨‹æ¨¡å¼ã€‚</p><h2 id="datasourcehealthindicator-æºç æ ¸å¿ƒéƒ¨åˆ†"><a class="headerlink" href="#datasourcehealthindicator-æºç æ ¸å¿ƒéƒ¨åˆ†"></a> DataSourceHealthIndicator æºç æ ¸å¿ƒéƒ¨åˆ†</h2><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190812104113.png" alt="DataSourceHealthIndicator UMLç»“æ„"><span class="image-caption">DataSourceHealthIndicator UMLç»“æ„</span></p><p>æ ¹æ®UMLå›¾å¯çŸ¥ï¼š</p><ul><li><p>å®ç° InitializingBean æ¥å£ å¹¶å®ç° afterPropertiesSet() æ–¹æ³•<br><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190812104445.png" alt><br>å¦‚æœ dataSource ä¸ºnull åˆ™æŠ›å‡º IllegalStateException å¼‚å¸¸</p></li><li><p>ç»§æ‰¿ AbstractHealthIndicator æŠ½è±¡ç±» å¹¶å®ç°doHealthCheck() æ–¹æ³•<br><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190812105030.png" alt><br>å¦‚æœ dataSource ä¸ºnull åˆ™ æ ‡è®° up å¹¶æ˜¾ç¤º database unknow. å¦åˆ™æ‰§è¡Œ doDataSourceHealthCheck()<br><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190812105620.png" alt></p></li></ul><h2 id="datasourcehealthindicatorautoconfiguration-æºç æ ¸å¿ƒéƒ¨åˆ†"><a class="headerlink" href="#datasourcehealthindicatorautoconfiguration-æºç æ ¸å¿ƒéƒ¨åˆ†"></a> DataSourceHealthIndicatorAutoConfiguration æºç æ ¸å¿ƒéƒ¨åˆ†</h2><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190812111404.png" alt="DataSourceHealthIndicatorAutoConfiguration UMLç»“æ„"><span class="image-caption">DataSourceHealthIndicatorAutoConfiguration UMLç»“æ„</span></p><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190812111220.png" alt></p><p>æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// æŸä¸ªclassä½äºç±»è·¯å¾„ä¸Šï¼Œæ‰ä¼šå®ä¾‹åŒ–ä¸€ä¸ªBean è¿™é‡Œæ˜¯JdbcTemplateå’ŒAbstractRoutingDataSourceå­˜åœ¨æ—¶æ‰å®ä¾‹åŒ–</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123; JdbcTemplate<span class="class">.<span class="keyword">class</span>, <span class="title">AbstractRoutingDataSource</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class">// ä»…ä»…åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨æŸä¸ªå¯¹è±¡æ—¶ï¼Œæ‰ä¼šå®ä¾‹åŒ–ä¸€ä¸ª<span class="title">Bean</span> è¿™é‡Œæ˜¯<span class="title">DataSource</span> çš„<span class="title">bean</span>å­˜åœ¨æ˜¯</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnBean</span>(<span class="title">DataSource</span>.<span class="title">class</span>)</span></span><br><span class="line">// Actuator ä¸­è‡ªå®šä¹‰çš„ EnabledHealthIndicator ä¸­ åŒ…å« "x" æ—¶å®ä¾‹åŒ–Bean</span><br><span class="line"><span class="meta">@ConditionalOnEnabledHealthIndicator</span>(<span class="string">"db"</span>)</span><br><span class="line"><span class="meta">@AutoConfigureBefore</span>(HealthIndicatorAutoConfiguration<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureAfter</span>(<span class="title">DataSourceAutoConfiguration</span>.<span class="title">class</span>)</span></span><br></pre></td></tr></table></figure><p>ä»¥æ­¤å¯ä»¥çœ‹å‡ºï¼ŒActuator çš„ healthy æ˜¯ä¾èµ–äº config é…ç½®çš„å®ä¾‹åŒ–æœºåˆ¶ï¼Œé€šè¿‡beanåŠ è½½æ‰€éœ€çš„èµ„æºè¿›è¡ŒéªŒè¯ã€‚</p><p>æ‰€ä»¥å¯¹äºè‡ªå®šä¹‰çš„æ£€æµ‹æŒ‡æ ‡å¯æŒ‰ç…§è¿™ç§æ–¹å¼è¿›è¡Œç¼–ç¨‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å¼•&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#å¼•&quot;&gt;&lt;/a&gt; å¼•&lt;/h2&gt;
&lt;p&gt;Spring Boot Actuator æœ‰å‡ ä¸ªé¢„å®šä¹‰çš„å¥åº·æŒ‡æ ‡æ¯”å¦‚ DataSourceHealthIndicator, DiskSpaceHealthIndic
      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="spring cloud" scheme="https://theembers.github.io/categories/dev/spring-cloud/"/>
    
    
      <category term="Spring Cloud Health" scheme="https://theembers.github.io/tags/Spring-Cloud-Health/"/>
    
  </entry>
  
  <entry>
    <title>IOT[1]-MQTTç›¸å…³ä»‹ç»</title>
    <link href="https://theembers.github.io/2019/08/02/iot-1-mqtt/"/>
    <id>https://theembers.github.io/2019/08/02/iot-1-mqtt/</id>
    <published>2019-08-02T02:12:37.000Z</published>
    <updated>2020-03-05T02:50:57.367Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a class="headerlink" href="#ç®€ä»‹"></a> ç®€ä»‹</h2><p>MQTT å…¨ç§°ä¸º Message Queuing Telemetry Transportï¼ˆæ¶ˆæ¯é˜Ÿåˆ—é¥æµ‹ä¼ è¾“ï¼‰æ˜¯ä¸€ç§åŸºäºå‘å¸ƒ/è®¢é˜…èŒƒå¼çš„â€œè½»é‡çº§â€æ¶ˆæ¯åè®®ï¼Œç”± IBM å‘å¸ƒã€‚</p><ul><li>MQTT å¯ä»¥è¢«è§£é‡Šä¸ºä¸€ç§ä½å¼€é”€ï¼Œä½å¸¦å®½å ç”¨çš„å³æ—¶é€šè®¯åè®®ï¼Œå¯ä»¥ç”¨æå°‘çš„ä»£ç å’Œå¸¦å®½çš„ä¸ºè¿æ¥è¿œç¨‹è®¾å¤‡æä¾›å®æ—¶å¯é çš„æ¶ˆæ¯æœåŠ¡ï¼Œå®ƒé€‚ç”¨äºç¡¬ä»¶æ€§èƒ½ä½ä¸‹çš„è¿œç¨‹è®¾å¤‡ä»¥åŠç½‘ç»œçŠ¶å†µç³Ÿç³•çš„ç¯å¢ƒä¸‹ï¼Œå› æ­¤ MQTT åè®®åœ¨ IoTï¼ˆInternet of thingsï¼Œç‰©è”ç½‘ï¼‰ï¼Œå°å‹è®¾å¤‡åº”ç”¨ï¼Œç§»åŠ¨åº”ç”¨ç­‰æ–¹é¢æœ‰è¾ƒå¹¿æ³›çš„åº”ç”¨ã€‚</li><li>IoT è®¾å¤‡è¦è¿ä½œï¼Œå°±å¿…é¡»è¿æ¥åˆ°äº’è”ç½‘ï¼Œè®¾å¤‡æ‰èƒ½ç›¸äº’åä½œï¼Œä»¥åŠä¸åç«¯æœåŠ¡ååŒå·¥ä½œã€‚è€Œäº’è”ç½‘çš„åŸºç¡€ç½‘ç»œåè®®æ˜¯ TCP/IPï¼ŒMQTT åè®®æ˜¯åŸºäº TCP/IP åè®®æ ˆè€Œæ„å»ºçš„ï¼Œå› æ­¤å®ƒå·²ç»æ…¢æ…¢çš„å·²ç»æˆä¸ºäº† IoT é€šè®¯çš„æ ‡å‡†ã€‚</li></ul><h2 id="åŸºæœ¬ç‰¹æ€§"><a class="headerlink" href="#åŸºæœ¬ç‰¹æ€§"></a> åŸºæœ¬ç‰¹æ€§</h2><ul><li>MQTTæ˜¯ä¸€ç§<strong>å‘å¸ƒ/è®¢é˜…</strong>çš„ä¼ è¾“åè®®<br>MQTT åè®®æä¾›ä¸€å¯¹å¤šçš„æ¶ˆæ¯å‘å¸ƒï¼Œå¯ä»¥è§£é™¤åº”ç”¨ç¨‹åºè€¦åˆï¼Œä¿¡æ¯å†—ä½™å°ã€‚è¯¥åè®®éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œè€Œåè®®ä¸­ä¸»è¦æœ‰ä¸‰ç§èº«ä»½ï¼šå‘å¸ƒè€…ï¼ˆPublisherï¼‰ã€ä»£ç†ï¼ˆBrokerï¼ŒæœåŠ¡å™¨ï¼‰ã€è®¢é˜…è€…ï¼ˆSubscriberï¼‰ã€‚å…¶ä¸­ï¼Œæ¶ˆæ¯çš„å‘å¸ƒè€…å’Œè®¢é˜…è€…éƒ½æ˜¯å®¢æˆ·ç«¯ï¼Œæ¶ˆæ¯ä»£ç†æ˜¯æœåŠ¡å™¨ï¼Œè€Œæ¶ˆæ¯å‘å¸ƒè€…å¯ä»¥åŒæ—¶æ˜¯è®¢é˜…è€…ï¼Œå®ç°äº†ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…çš„è„±è€¦ã€‚</li><li>åŸºäº TCP/IP æä¾›ç½‘ç»œè¿æ¥ï¼Œæä¾›æœ‰åºã€æ— æŸã€åŒå‘è¿æ¥</li><li>å¯¹è´Ÿè½½å†…å®¹å±è”½çš„æ¶ˆæ¯ä¼ è¾“ï¼ˆå®‰å…¨æ€§ï¼‰</li><li>å…·ä½“æœ‰ä¸‰ç§æ¶ˆæ¯å‘å¸ƒçš„æœåŠ¡è´¨é‡ï¼š<ul><li>è‡³å¤šä¸€æ¬¡ï¼Œæ¶ˆæ¯å‘å¸ƒå®Œå…¨ä¾èµ–åº•å±‚ TCP/IP ç½‘ç»œã€‚ä¼šå‘ç”Ÿæ¶ˆæ¯ä¸¢å¤±æˆ–é‡å¤ã€‚è¿™ä¸€çº§åˆ«å¯ç”¨äºå¦‚ä¸‹æƒ…å†µï¼Œç¯å¢ƒä¼ æ„Ÿå™¨æ•°æ®ï¼Œä¸¢å¤±ä¸€æ¬¡è¯»è®°å½•æ— æ‰€è°“ï¼Œå› ä¸ºä¸ä¹…åè¿˜ä¼šæœ‰ç¬¬äºŒæ¬¡å‘é€ã€‚</li><li>è‡³å°‘ä¸€æ¬¡ï¼Œç¡®ä¿æ¶ˆæ¯åˆ°è¾¾ï¼Œä½†æ¶ˆæ¯é‡å¤å¯èƒ½ä¼šå‘ç”Ÿã€‚</li><li>åªæœ‰ä¸€æ¬¡ï¼Œç¡®ä¿æ¶ˆæ¯åˆ°è¾¾ä¸€æ¬¡ã€‚è¿™ä¸€çº§åˆ«å¯ç”¨äºå¦‚ä¸‹æƒ…å†µï¼Œåœ¨è®¡è´¹ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯é‡å¤æˆ–ä¸¢å¤±ä¼šå¯¼è‡´ä¸æ­£ç¡®çš„ç»“æœã€‚</li></ul></li><li>å°å‹ä¼ è¾“ï¼Œå¼€é”€å°ï¼Œå›ºå®šé•¿åº¦çš„å¤´éƒ¨æ˜¯ 2 å­—èŠ‚ï¼Œåè®®äº¤æ¢æœ€å°åŒ–ï¼Œä»¥é™ä½ç½‘ç»œæµé‡<br>æ•´ä½“ä¸Šåè®®å¯æ‹†åˆ†ä¸ºï¼šå›ºå®šå¤´éƒ¨+å¯å˜å¤´éƒ¨+æ¶ˆæ¯ä½“ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä»‹ç»é‡Œè¯´å®ƒéå¸¸é€‚åˆ&quot;åœ¨ç‰©è”ç½‘é¢†åŸŸï¼Œä¼ æ„Ÿå™¨ä¸æœåŠ¡å™¨çš„é€šä¿¡ï¼Œä¿¡æ¯çš„æ”¶é›†&quot;ã€‚</li><li>ä½¿ç”¨Last Willå’ŒTestamentç‰¹æ€§é€šçŸ¥æœ‰å…³å„æ–¹å®¢æˆ·ç«¯å¼‚å¸¸ä¸­æ–­çš„æœºåˆ¶<br>Last Willï¼šå³é—è¨€æœºåˆ¶ï¼Œç”¨äºé€šçŸ¥åŒä¸€ä¸»é¢˜ä¸‹çš„å…¶ä»–è®¾å¤‡å‘é€é—è¨€çš„è®¾å¤‡å·²ç»æ–­å¼€äº†è¿æ¥ã€‚<br>Testamentï¼šé—å˜±æœºåˆ¶ï¼ŒåŠŸèƒ½ç±»ä¼¼äºLast Willã€‚</li></ul><h2 id="åŸºæœ¬æ¦‚å¿µ"><a class="headerlink" href="#åŸºæœ¬æ¦‚å¿µ"></a> åŸºæœ¬æ¦‚å¿µ</h2><h3 id="mqtt-å®¢æˆ·ç«¯"><a class="headerlink" href="#mqtt-å®¢æˆ·ç«¯"></a> MQTT å®¢æˆ·ç«¯</h3><ul><li>å‘å¸ƒæ¶ˆæ¯</li><li>è®¢é˜…æ¶ˆæ¯</li><li>é€€è®¢æˆ–åˆ é™¤æ¶ˆæ¯</li><li>æ–­å¼€ä¸æœåŠ¡å™¨è¿æ¥</li></ul><h3 id="mqtt-æœåŠ¡ç«¯-brokeræ¶ˆæ¯ä»£ç†"><a class="headerlink" href="#mqtt-æœåŠ¡ç«¯-brokeræ¶ˆæ¯ä»£ç†"></a> MQTT æœåŠ¡ç«¯ Brokerï¼ˆæ¶ˆæ¯ä»£ç†ï¼‰</h3><ul><li>æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„ç½‘ç»œè¿æ¥</li><li>æ¥å—å®¢æˆ·ç«¯å‘å¸ƒçš„åº”ç”¨ä¿¡æ¯</li><li>å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„è®¢é˜…å’Œé€€è®¢è¯·æ±‚</li><li>å‘è®¢é˜…çš„å®¢æˆ·è½¬å‘åº”ç”¨ç¨‹åºæ¶ˆæ¯</li></ul><h3 id="ä¸»é¢˜topic"><a class="headerlink" href="#ä¸»é¢˜topic"></a> ä¸»é¢˜ï¼ˆtopicï¼‰</h3><p>è¿æ¥åˆ°ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¶ˆæ¯çš„æ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾ä¸æœåŠ¡å™¨çš„è®¢é˜…ç›¸åŒ¹é…ã€‚æœåŠ¡å™¨ä¼šå°†æ¶ˆæ¯å‘é€ç»™è®¢é˜…æ‰€åŒ¹é…æ ‡ç­¾çš„æ¯ä¸ªå®¢æˆ·ç«¯ã€‚</p><p>è¦è®¢é˜…çš„ä¸»é¢˜ã€‚ä¸€ä¸ªä¸»é¢˜å¯ä»¥æœ‰å¤šä¸ªçº§åˆ«ï¼Œçº§åˆ«ä¹‹é—´ç”¨æ–œæ å­—ç¬¦åˆ†éš”ã€‚ä¾‹å¦‚ï¼Œ/world å’Œ emq/emqtt/emqx æ˜¯æœ‰æ•ˆçš„ä¸»é¢˜ã€‚</p><p>è®¢é˜…è€…çš„Topic nameæ”¯æŒé€šé…ç¬¦#å’Œ+ ï¼š</p><ul><li>#æ”¯æŒä¸€ä¸ªä¸»é¢˜å†…ä»»æ„çº§åˆ«è¯é¢˜</li><li>+åªåŒ¹é…ä¸€ä¸ªä¸»é¢˜çº§åˆ«çš„é€šé…ç¬¦</li></ul><p>å®¢æˆ·ç«¯æˆåŠŸè®¢é˜…æŸä¸ªä¸»é¢˜åï¼Œä»£ç†ä¼šè¿”å›ä¸€æ¡ SUBACK æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª returnCode å‚æ•°</p><h3 id="ä¸»é¢˜ç­›é€‰å™¨topic-filter"><a class="headerlink" href="#ä¸»é¢˜ç­›é€‰å™¨topic-filter"></a> ä¸»é¢˜ç­›é€‰å™¨ï¼ˆTopic Filterï¼‰</h3><p>ä¸€ä¸ªå¯¹ä¸»é¢˜åé€šé…ç¬¦ç­›é€‰å™¨ï¼Œåœ¨è®¢é˜…è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼Œè¡¨ç¤ºè®¢é˜…æ‰€åŒ¹é…åˆ°çš„å¤šä¸ªä¸»é¢˜ã€‚</p><h3 id="qosæ¶ˆæ¯ä¼ é€’çš„æœåŠ¡è´¨é‡æ°´å¹³"><a class="headerlink" href="#qosæ¶ˆæ¯ä¼ é€’çš„æœåŠ¡è´¨é‡æ°´å¹³"></a> QoSï¼ˆæ¶ˆæ¯ä¼ é€’çš„æœåŠ¡è´¨é‡æ°´å¹³ï¼‰</h3><p>æœåŠ¡è´¨é‡ï¼Œæ ‡å¿—è¡¨æ˜æ­¤ä¸»é¢˜èŒƒå›´å†…çš„æ¶ˆæ¯ä¼ é€åˆ°å®¢æˆ·ç«¯æ‰€éœ€çš„ä¸€è‡´ç¨‹åº¦ã€‚</p><ul><li>å€¼ 0ï¼šä¸å¯é ï¼Œæ¶ˆæ¯åŸºæœ¬ä¸Šä»…ä¼ é€ä¸€æ¬¡ï¼Œå¦‚æœå½“æ—¶å®¢æˆ·ç«¯ä¸å¯ç”¨ï¼Œåˆ™ä¼šä¸¢å¤±è¯¥æ¶ˆæ¯ã€‚</li><li>å€¼ 1ï¼šæ¶ˆæ¯åº”ä¼ é€è‡³å°‘ 1 æ¬¡ã€‚</li><li>å€¼ 2ï¼šæ¶ˆæ¯ä»…ä¼ é€ä¸€æ¬¡ã€‚</li></ul><h3 id><a class="headerlink" href="#"></a> </h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç®€ä»‹&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#ç®€ä»‹&quot;&gt;&lt;/a&gt; ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;MQTT å…¨ç§°ä¸º Message Queuing Telemetry Transportï¼ˆæ¶ˆæ¯é˜Ÿåˆ—é¥æµ‹ä¼ è¾“ï¼‰æ˜¯ä¸€ç§åŸºäºå‘å¸ƒ/è®¢é˜…èŒƒå¼çš„â€œè½»é‡çº§â€æ¶ˆæ¯åè®®ï¼Œç”± 
      
    
    </summary>
    
      <category term="iot" scheme="https://theembers.github.io/categories/iot/"/>
    
    
      <category term="iot" scheme="https://theembers.github.io/tags/iot/"/>
    
      <category term="mqtt" scheme="https://theembers.github.io/tags/mqtt/"/>
    
  </entry>
  
  <entry>
    <title>IOT[0]-è®¾å¤‡æ¥å…¥&amp;æ•°æ®æµè½¬æ¶æ„è®¾è®¡å›¾</title>
    <link href="https://theembers.github.io/2019/08/01/iot-0/"/>
    <id>https://theembers.github.io/2019/08/01/iot-0/</id>
    <published>2019-08-01T06:34:45.000Z</published>
    <updated>2020-03-05T03:01:42.366Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190801162249.jpg" alt="IOTè®¾å¤‡æ¥å…¥&amp;æ•°æ®æµè½¬æ¶æ„è®¾è®¡å›¾"><span class="image-caption">IOTè®¾å¤‡æ¥å…¥&amp;æ•°æ®æµè½¬æ¶æ„è®¾è®¡å›¾</span></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190801162249.jpg&quot; alt=&quot;IOTè®¾å¤‡æ¥å…¥&amp;amp;æ•°æ®æµè½¬æ¶æ„è®¾è®¡å›¾&quot;&gt;&lt;span class=&quot;ima
      
    
    </summary>
    
      <category term="iot" scheme="https://theembers.github.io/categories/iot/"/>
    
    
      <category term="iot" scheme="https://theembers.github.io/tags/iot/"/>
    
      <category term="framework" scheme="https://theembers.github.io/tags/framework/"/>
    
  </entry>
  
  <entry>
    <title>spring cloud health - actuatorç›¸å…³</title>
    <link href="https://theembers.github.io/2019/07/15/spring-cloud-health/"/>
    <id>https://theembers.github.io/2019/07/15/spring-cloud-health/</id>
    <published>2019-07-15T02:41:48.000Z</published>
    <updated>2020-03-05T02:50:57.392Z</updated>
    
    <content type="html"><![CDATA[<h2 id="eureka-health-å‰ç½®"><a class="headerlink" href="#eureka-health-å‰ç½®"></a> Eureka Health å‰ç½®</h2><ul><li>spring boot/cloud ç‰ˆæœ¬ 2.0.1</li><li>JDK 1.8</li></ul><p>é»˜è®¤æƒ…å†µä¸‹æ³¨å†Œåˆ°eureka serverçš„æœåŠ¡æ˜¯é€šè¿‡å¿ƒè·³æ¥å‘ŠçŸ¥è‡ªå·±æ˜¯UPè¿˜æ˜¯DOWNï¼Œå¹¶ä¸æ˜¯é€šè¿‡spring-boot-actuatoræ¨¡å—çš„/healthç«¯ç‚¹æ¥å®ç°çš„ã€‚<br>é»˜è®¤çš„å¿ƒè·³å®ç°æ–¹å¼å¯ä»¥æœ‰æ•ˆçš„æ£€æŸ¥eurekaå®¢æˆ·ç«¯è¿›ç¨‹æ˜¯å¦æ­£å¸¸è¿ä½œï¼Œä½†æ˜¯æ— æ³•ä¿è¯å®¢æˆ·ç«¯åº”ç”¨èƒ½å¤Ÿæ­£å¸¸æä¾›æœåŠ¡ã€‚ç”±äºå¤§å¤šæ•°å¾®æœåŠ¡åº”ç”¨éƒ½ä¼šæœ‰ä¸€äº›å…¶ä»–çš„å¤–éƒ¨èµ„æºä¾èµ–ï¼Œæ¯”å¦‚æ•°æ®åº“ï¼ŒREDISç¼“å­˜ç­‰ï¼Œå¦‚æœæˆ‘ä»¬çš„åº”ç”¨ä¸è¿™äº›å¤–éƒ¨èµ„æºæ— æ³•è¿é€šçš„æ—¶å€™ï¼Œå®é™…ä¸Šå·²ç»ä¸èƒ½æä¾›æ­£å¸¸çš„å¯¹å¤–æœåŠ¡äº†ï¼Œä½†å› ä¸ºå®¢æˆ·ç«¯å¿ƒè·³ä¾ç„¶åœ¨è¿è¡Œï¼Œæ‰€ä»¥å®ƒè¿˜æ˜¯ä¼šè¢«æœåŠ¡æ¶ˆè´¹è€…è°ƒç”¨ï¼Œè€Œè¿™æ ·çš„è°ƒç”¨å®é™…ä¸Šå¹¶ä¸èƒ½è·å¾—é¢„æœŸçš„åæœã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨eurekaå®¢æˆ·ç«¯ä¸­é…ç½®:<code>eureka.client.healthcheck.enabled=true</code>ï¼Œå°±å¯ä»¥æ”¹å˜eureka serverå¯¹å®¢æˆ·ç«¯å¥åº·æ£€æµ‹çš„æ–¹å¼ï¼Œæ”¹ç”¨actuatorçš„/healthç«¯ç‚¹æ¥æ£€æµ‹ã€‚</p><h2 id="å…³äº-spring-boot-starter-actuator"><a class="headerlink" href="#å…³äº-spring-boot-starter-actuator"></a> å…³äº spring-boot-starter-actuator</h2><h3 id="ä¾èµ–"><a class="headerlink" href="#ä¾èµ–"></a> ä¾èµ–</h3><p><code>org.springframework.boot:spring-boot-starter-actuator</code></p><h3 id="api"><a class="headerlink" href="#api"></a> API</h3><p><code>http://ip:port/[project-content-path]/actuator/**</code></p><p><strong>ä»¥å‰çš„ç‰ˆæœ¬æ˜¯æ²¡æœ‰/actuatorå‰ç¼€çš„ï¼Œ2.0ä»¥åçš„ç‰ˆæœ¬éƒ½åŠ äº†/actuatorå‰ç¼€</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œactuatoråªæš´éœ²äº† <code>/health</code> å’Œ <code>/info</code> ä¸¤ä¸ªæ¥å£ï¼Œå…¶ä»–æ¥å£å¯ä»¥åœ¨ymlä¸­æ·»åŠ å¦‚ä¸‹é…ç½®æ‰“å¼€ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">"*"</span></span><br></pre></td></tr></table></figure><ul><li><p>æŸ¥çœ‹æ”¯æŒçš„apiåˆ—è¡¨ï¼š<code>http://ip:port/[project-content-path]/actuator</code><br>è¿”å›ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"_links"</span>: &#123;</span><br><span class="line">    <span class="attr">"self"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"archaius"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/archaius"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"auditevents"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/auditevents"</span>, </span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span> æ˜¾ç¤ºåº”ç”¨æš´éœ²çš„å®¡è®¡äº‹ä»¶ (æ¯”å¦‚è®¤è¯è¿›å…¥ã€å¤±è´¥)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"beans"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/beans"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span> åŠ è½½çš„beanåˆ—è¡¨</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"health"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/health"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span> å¥åº·çŠ¶æ€ up down</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"conditions"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/conditions"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span> æ˜¾ç¤ºåœ¨é…ç½®å’Œè‡ªåŠ¨é…ç½®ç±»ä¸Šè¯„ä¼°çš„æ¡ä»¶ä»¥åŠå®ƒä»¬åŒ¹é…æˆ–ä¸åŒ¹é…çš„åŸå› </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"configprops"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/configprops"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span> æ˜¾ç¤ºæ‰€æœ‰çš„é…ç½®åˆ—è¡¨ @ConfigurationProperties</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"env"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/env"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span> ç¯å¢ƒå˜é‡ä¿¡æ¯</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"env-toMatch"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/env/&#123;toMatch&#125;"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"info"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/info"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"loggers"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/loggers"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span> æ—¥å¿—åŸ‹ç‚¹ä¿¡æ¯</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"loggers-name"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/loggers/&#123;name&#125;"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"heapdump"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/heapdump"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"threaddump"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/threaddump"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span> æ‰§è¡Œçº¿ç¨‹è½¬å‚¨</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"metrics-requiredMetricName"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/metrics/&#123;requiredMetricName&#125;"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">true</span> æ˜¾ç¤ºå½“å‰åº”ç”¨ç¨‹åºçš„â€œæŒ‡æ ‡â€ä¿¡æ¯</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"metrics"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/metrics"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span> æ˜¾ç¤ºå½“å‰åº”ç”¨ç¨‹åºçš„â€œæŒ‡æ ‡â€ä¿¡æ¯åç§°åˆ—è¡¨ï¼ˆrequiredMetricName åˆ—è¡¨ï¼‰</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"scheduledtasks"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/scheduledtasks"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"httptrace"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/httptrace"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span> æœ€è¿‘çš„<span class="number">100</span>ä¸ªï¼ˆé»˜è®¤ï¼‰httpè¯·æ±‚ä¿¡æ¯</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"mappings"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/mappings"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span> æ˜¾ç¤ºæ‰€æœ‰@RequestMappingè·¯å¾„çš„æ•´ç†åˆ—è¡¨</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"refresh"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/refresh"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"features"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/features"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"service-registry"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/service-registry"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"hystrix.stream"</span>: &#123;</span><br><span class="line">      <span class="attr">"href"</span>: <span class="string">"http://192.168.9.73:19342/actuator/hystrix.stream"</span>,</span><br><span class="line">      <span class="attr">"templated"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ›´å¤šè¯´æ˜ï¼š<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html</a></p></blockquote></li></ul><h2 id="health-ç›¸å…³"><a class="headerlink" href="#health-ç›¸å…³"></a> /health ç›¸å…³</h2><p><code>http://ip:port/[project-content-path]/actuator/health</code><br>é»˜è®¤åªä¼šæ˜¾ç¤ºstatusçŠ¶æ€å€¼ up æˆ–è€… downï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºè¯¦ç»†è¯¦ç»†éœ€è¦åœ¨é…ç½®ä¸­è®¾ç½®ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">always</span> </span><br><span class="line">      <span class="comment"># é»˜è®¤ä¸º 'never' æ°¸è¿œä¸æ˜¾ç¤º</span></span><br><span class="line">      <span class="comment"># 'when-authorized' è¯¦ç»†ä¿¡æ¯ä»…å‘æˆæƒç”¨æˆ·æ˜¾ç¤ºã€‚å¯ä»¥ä½¿ç”¨é…ç½®æˆæƒè§’è‰² management.endpoint.health.rolesã€‚</span></span><br><span class="line">      <span class="comment"># always å§‹ç»ˆæ˜¾ç¤º</span></span><br></pre></td></tr></table></figure><h3 id="healthindicators-å¥åº·æŒ‡æ ‡"><a class="headerlink" href="#healthindicators-å¥åº·æŒ‡æ ‡"></a> HealthIndicators å¥åº·æŒ‡æ ‡</h3><ul><li>é»˜è®¤è‡ªå¸¦ä»¥ä¸‹å¥åº·æ£€æµ‹é¡¹ç›®ï¼š</li></ul><table><thead><tr><th style="text-align:left">åç§°</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left">CassandraHealthIndicator</td><td style="text-align:left">Checks that a Cassandra database is up.</td></tr><tr><td style="text-align:left">CouchbaseHealthIndicator</td><td style="text-align:left">Checks that a Couchbase cluster is up.</td></tr><tr><td style="text-align:left">DiskSpaceHealthIndicator</td><td style="text-align:left">Checks for low disk space.</td></tr><tr><td style="text-align:left">DataSourceHealthIndicator</td><td style="text-align:left">Checks that a connection to DataSource can be obtained.</td></tr><tr><td style="text-align:left">ElasticsearchHealthIndicator</td><td style="text-align:left">Checks that an Elasticsearch cluster is up.</td></tr><tr><td style="text-align:left">InfluxDbHealthIndicator</td><td style="text-align:left">Checks that an InfluxDB server is up.</td></tr><tr><td style="text-align:left">JmsHealthIndicator</td><td style="text-align:left">Checks that a JMS broker is up.</td></tr><tr><td style="text-align:left">MailHealthIndicator</td><td style="text-align:left">Checks that a mail server is up.</td></tr><tr><td style="text-align:left">MongoHealthIndicator</td><td style="text-align:left">Checks that a Mongo database is up.</td></tr><tr><td style="text-align:left">Neo4jHealthIndicator</td><td style="text-align:left">Checks that a Neo4j server is up.</td></tr><tr><td style="text-align:left">RabbitHealthIndicator</td><td style="text-align:left">Checks that a Rabbit server is up.</td></tr><tr><td style="text-align:left">RedisHealthIndicator</td><td style="text-align:left">Checks that a Redis server is up.</td></tr><tr><td style="text-align:left">SolrHealthIndicator</td><td style="text-align:left">Checks that a Solr server is up.</td></tr></tbody></table><ul><li><p>è‡ªå®šä¹‰ HealthIndicator</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtendedHealthIndicator</span> <span class="keyword">implements</span> <span class="title">HealthIndicator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Health <span class="title">health</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> errorCode = check(); <span class="comment">// perform some specific health check æ‰§è¡Œè‡ªå®šä¹‰çš„æ£€æµ‹é€»è¾‘ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (errorCode != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Health.down().withDetail(<span class="string">"Error Code"</span>, errorCode).build();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Health.up().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">check</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// å‡è£…æ£€æµ‹åˆ°å¼‚å¸¸</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>/health</code> apiä¸­ä¼šå¤šè¿”å›ä¸€ä¸ªåä¸ºExtendedçš„é¡¹ï¼Œå¦‚å›¾ï¼š<br><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190715150821.png" alt></p><p>åŒæ—¶åœ¨eurekaä¸­ï¼š<br><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190715151120.png" alt></p><h3 id="å“åº”å¼-healthindicator"><a class="headerlink" href="#å“åº”å¼-healthindicator"></a> å“åº”å¼ HealthIndicator</h3><p>å“åº”å¼ç¼–ç¨‹ç›¸å…³ spring reactor.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtendedReactiveHealthIndicator</span> <span class="keyword">implements</span> <span class="title">ReactiveHealthIndicator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Health&gt; <span class="title">health</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> doHealthCheck() <span class="comment">//perform some specific health check that returns a Mono&lt;Health&gt;</span></span><br><span class="line">                .onErrorResume(ex -&gt; Mono.just(<span class="keyword">new</span> Health.Builder().down(ex).build())));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="loggers-ç›¸å…³"><a class="headerlink" href="#loggers-ç›¸å…³"></a> /loggers ç›¸å…³</h2><ul><li><p>æŸ¥çœ‹<br><code>http://ip:port/[project-content-path]/actuator/loggers</code><br>æŸ¥çœ‹åº”ç”¨ä¸­å¯é…ç½®çš„loggersçš„åˆ—è¡¨å’Œç›¸å…³çš„æ—¥å¿—ç­‰çº§ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"levels"</span>: [</span><br><span class="line">    <span class="string">"OFF"</span>,</span><br><span class="line">    <span class="string">"ERROR"</span>,</span><br><span class="line">    <span class="string">"WARN"</span>,</span><br><span class="line">    <span class="string">"INFO"</span>,</span><br><span class="line">    <span class="string">"DEBUG"</span>,</span><br><span class="line">    <span class="string">"TRACE"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"loggers"</span>: &#123;</span><br><span class="line">    <span class="attr">"ROOT"</span>: &#123;</span><br><span class="line">      <span class="attr">"configuredLevel"</span>: <span class="string">"INFO"</span>,</span><br><span class="line">      <span class="attr">"effectiveLevel"</span>: <span class="string">"INFO"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"com"</span>: &#123;</span><br><span class="line">      <span class="attr">"configuredLevel"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"effectiveLevel"</span>: <span class="string">"INFO"</span></span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æŸä¸€é¡¹<br><code>http://ip:port/[project-content-path]/actuator/loggers</code></p></li><li><p>è¿è¡Œæ—¶æ”¹å˜æ—¥å¿—ç­‰çº§<br>ä½¿ç”¨POSTè¯·æ±‚å¯ä»¥ä¿®æ”¹æŸä¸€é¡¹çš„æ—¥å¿—ç­‰çº§,ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST http://ip:port/[project-content-path]/actuator/loggers/ROOT</span><br><span class="line">body:</span><br><span class="line">&#123;</span><br><span class="line"> &quot;configuredLevel&quot;: &quot;INFO&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;eureka-health-å‰ç½®&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#eureka-health-å‰ç½®&quot;&gt;&lt;/a&gt; Eureka Health å‰ç½®&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;spring boot/cloud ç‰ˆæœ¬ 2.0.1&lt;/li&gt;
      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="spring cloud" scheme="https://theembers.github.io/categories/dev/spring-cloud/"/>
    
    
      <category term="Spring Cloud Health" scheme="https://theembers.github.io/tags/Spring-Cloud-Health/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearch[7]-æ˜ å°„(mapping)</title>
    <link href="https://theembers.github.io/2019/07/10/es-7/"/>
    <id>https://theembers.github.io/2019/07/10/es-7/</id>
    <published>2019-07-10T02:45:25.000Z</published>
    <updated>2020-03-05T02:50:57.362Z</updated>
    
    <content type="html"><![CDATA[<p>å½“ESåœ¨æ–‡æ¡£ä¸­æ¢æµ‹åˆ°æ–°çš„å­—ç¬¦ä¸²å­—æ®µå°†é»˜è®¤è®¾ç½®ä¸ºå…¨æ–‡stringå­—æ®µå¹¶ä½¿ç”¨æ ‡å‡†åˆ†æå™¨ï¼ˆstandardï¼‰åˆ†æã€‚ä¸ºäº†ä½¿ç”¨æ›´é€‚åˆçš„åˆ†æå™¨æˆ–è€…ä¸åšä»»ä½•å¤„ç†ï¼Œåˆ™éœ€è¦ä½¿ç”¨æ˜ å°„ï¼ˆmappingï¼‰ã€‚</p><p>ä¹‹å‰æåˆ°æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼ˆtypeï¼‰ï¼Œæ¯ä¸ªç±»å‹éƒ½æœ‰ä¸€ä¸ªæ˜ å°„ï¼ˆmappingï¼‰æˆ–è€…æ¨¡å¼å®šä¹‰ï¼ˆschema definitionï¼‰ä¸€ä¸ªæ˜ å°„å®šä¹‰äº†å­—æ®µç±»å‹ï¼Œæ¯ä¸ªå­—æ®µçš„æ•°æ®ç±»å‹ï¼Œä»¥åŠå­—æ®µè¢«Elasticsearchå¤„ç†çš„æ–¹å¼ã€‚æ˜ å°„è¿˜ç”¨äºè®¾ç½®å…³è”åˆ°ç±»å‹ä¸Šçš„å…ƒæ•°æ®ã€‚</p><h2 id="æŸ¥çœ‹æ˜ å°„"><a class="headerlink" href="#æŸ¥çœ‹æ˜ å°„"></a> æŸ¥çœ‹æ˜ å°„</h2><p><code>GET /{index}/_mapping/{type}</code></p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">GET /gb/_mapping/tweet</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"gb"</span>: &#123;</span><br><span class="line">    <span class="attr">"mappings"</span>: &#123;</span><br><span class="line">      <span class="attr">"tweet"</span>: &#123;</span><br><span class="line">        <span class="attr">"properties"</span>: &#123;</span><br><span class="line">          <span class="attr">"date"</span>: &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"date"</span>,</span><br><span class="line">            <span class="attr">"format"</span>: <span class="string">"strict_date_optional_time||epoch_millis"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"name"</span>: &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"tweet"</span>: &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"user_id"</span>: &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰å­—æ®µæ˜ å°„"><a class="headerlink" href="#è‡ªå®šä¹‰å­—æ®µæ˜ å°„"></a> è‡ªå®šä¹‰å­—æ®µæ˜ å°„</h2><p>è‡ªå®šä¹‰å­—æ®µæ˜ å°„å¯ä»¥ï¼š</p><ul><li>åŒºåˆ†å…¨æ–‡ï¼ˆfull textï¼‰å­—ç¬¦ä¸²å­—æ®µå’Œå‡†ç¡®å­—ç¬¦ä¸²å­—æ®µã€‚</li><li>ä½¿ç”¨ç‰¹å®šè¯­è¨€çš„åˆ†æå™¨</li><li>ä¼˜åŒ–éƒ¨åˆ†åŒ¹é…å­—æ®µ</li><li>æŒ‡å®šè‡ªå®šä¹‰æ—¥æœŸæ ¼å¼</li><li>â€¦</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"tag"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">    <span class="attr">"index"</span>: <span class="string">"not_analyzed"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>typeç”¨äºæ ‡è®°tagä¸ºstringç±»å‹</p></li><li><p>indexå¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:left">indexçš„å€¼</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left">analyzed é»˜è®¤å€¼</td><td style="text-align:left">é¦–å…ˆåˆ†æè¿™ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åç´¢å¼•ã€‚</td></tr><tr><td style="text-align:left">not_analyzed</td><td style="text-align:left">ç´¢å¼•è¿™ä¸ªå­—æ®µï¼Œä½¿ä¹‹å¯ä»¥è¢«æœç´¢ï¼Œä½†æ˜¯ç´¢å¼•å†…å®¹å’ŒæŒ‡å®šå€¼ä¸€æ ·ã€‚</td></tr><tr><td style="text-align:left">no</td><td style="text-align:left">ä¸ç´¢å¼•è¿™ä¸ªå­—æ®µã€‚è¿™ä¸ªå­—æ®µä¸èƒ½ä¸ºæœç´¢åˆ°ã€‚</td></tr></tbody></table><blockquote><p>å…¶ä»–ç®€å•ç±»å‹ï¼ˆ long ã€ double ã€ date ç­‰ç­‰ï¼‰ä¹Ÿæ¥å— index å‚æ•°ï¼Œä½†ç›¸åº”çš„å€¼åªèƒ½æ˜¯ no å’Œ not_analyzed ï¼Œå®ƒä»¬çš„å€¼ä¸èƒ½è¢«åˆ†æã€‚</p></blockquote></li><li><p>analyzer<br>å¯¹äº analyzed ç±»å‹çš„å­—ç¬¦ä¸²å­—æ®µï¼Œä½¿ç”¨ analyzer å‚æ•°æ¥æŒ‡å®šå“ªä¸€ç§åˆ†æå™¨å°†åœ¨æœç´¢å’Œç´¢å¼•çš„æ—¶å€™ä½¿ç”¨ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"tweet"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">    <span class="attr">"analyzer"</span>: <span class="string">"english"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="æ›´æ–°æ˜ å°„"><a class="headerlink" href="#æ›´æ–°æ˜ å°„"></a> æ›´æ–°æ˜ å°„</h2><p>å¯ä»¥åœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºç´¢å¼•çš„æ—¶å€™æŒ‡å®šæ˜ å°„çš„ç±»å‹ã€‚ä¹Ÿå¯ä»¥æ™šäº›æ—¶å€™ä¸ºæ–°ç±»å‹æ·»åŠ æ˜ å°„ï¼ˆæˆ–è€…ä¸ºå·²æœ‰çš„ç±»å‹æ›´æ–°æ˜ å°„ï¼‰ã€‚</p><p><strong>å¯ä»¥å‘å·²æœ‰æ˜ å°„ä¸­å¢åŠ å­—æ®µï¼Œä½†ä¸èƒ½ä¿®æ”¹å®ƒã€‚å¦‚æœä¸€ä¸ªå­—æ®µåœ¨æ˜ å°„ä¸­å·²ç»å­˜åœ¨ï¼Œè¿™å¯èƒ½æ„å‘³ç€é‚£ä¸ªå­—æ®µçš„æ•°æ®å·²ç»è¢«ç´¢å¼•ã€‚å¦‚æœä½ æ”¹å˜äº†å­—æ®µæ˜ å°„ï¼Œé‚£å·²ç»è¢«ç´¢å¼•çš„æ•°æ®å°†é”™è¯¯å¹¶ä¸”ä¸èƒ½è¢«æ­£ç¡®çš„æœç´¢åˆ°ã€‚</strong></p><h2 id="å¤åˆå¯¹è±¡çš„ç´¢å¼•ç»“æ„"><a class="headerlink" href="#å¤åˆå¯¹è±¡çš„ç´¢å¼•ç»“æ„"></a> å¤åˆå¯¹è±¡çš„ç´¢å¼•ç»“æ„</h2><p>å¯¹äºå¤æ‚å¯¹è±¡çš„mapping ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"gb"</span>: &#123;</span><br><span class="line">    <span class="attr">"tweet"</span>: &#123;</span><br><span class="line">      <span class="attr">"properties"</span>: &#123;</span><br><span class="line">        <span class="attr">"tweet"</span>: &#123;</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"user"</span>: &#123;</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"object"</span>,</span><br><span class="line">          <span class="attr">"properties"</span>: &#123;</span><br><span class="line">            <span class="attr">"id"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"gender"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"age"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"name"</span>: &#123;</span><br><span class="line">              <span class="attr">"type"</span>: <span class="string">"object"</span>,</span><br><span class="line">              <span class="attr">"properties"</span>: &#123;</span><br><span class="line">                <span class="attr">"full"</span>: &#123;</span><br><span class="line">                  <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"first"</span>: &#123;</span><br><span class="line">                  <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"last"</span>: &#123;</span><br><span class="line">                  <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"tweet"</span>: <span class="string">"Elasticsearch is very flexible"</span>,</span><br><span class="line">  <span class="attr">"user"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="string">"@johnsmith"</span>,</span><br><span class="line">    <span class="attr">"gender"</span>: <span class="string">"male"</span>,</span><br><span class="line">    <span class="attr">"age"</span>: <span class="number">26</span>,</span><br><span class="line">    <span class="attr">"name"</span>: &#123;</span><br><span class="line">      <span class="attr">"full"</span>: <span class="string">"John Smith"</span>,</span><br><span class="line">      <span class="attr">"first"</span>: <span class="string">"John"</span>,</span><br><span class="line">      <span class="attr">"last"</span>: <span class="string">"Smith"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># å…¶ç´¢å¼•æ–¹å¼ä¸ºå¹³é“ºçš„å•å±‚ç»“æ„ï¼š</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"tweet"</span>: [elasticsearch, flexible, very],</span><br><span class="line">  <span class="attr">"user.id"</span>: [@johnsmith],</span><br><span class="line">  <span class="attr">"user.gender"</span>: [male],</span><br><span class="line">  <span class="attr">"user.age"</span>: [<span class="number">26</span>],</span><br><span class="line">  <span class="attr">"user.name.full"</span>: [john, smith],</span><br><span class="line">  <span class="attr">"user.name.first"</span>: [john],</span><br><span class="line">  <span class="attr">"user.name.last"</span>: [smith]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"followers"</span>: [</span><br><span class="line">    &#123; <span class="attr">"age"</span>: <span class="number">35</span>, <span class="attr">"name"</span>: <span class="string">"Mary White"</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">"age"</span>: <span class="number">26</span>, <span class="attr">"name"</span>: <span class="string">"Alex Jones"</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">"age"</span>: <span class="number">19</span>, <span class="attr">"name"</span>: <span class="string">"Lisa Smith"</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># å…¶ç´¢å¼•æ–¹å¼ä¸ºå¹³é“ºçš„å•å±‚ç»“æ„ï¼š</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"followers.age"</span>: [<span class="number">19</span>, <span class="number">26</span>, <span class="number">35</span>],</span><br><span class="line">  <span class="attr">"followers.name"</span>: [alex, jones, lisa, smith, mary, white]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å½“ESåœ¨æ–‡æ¡£ä¸­æ¢æµ‹åˆ°æ–°çš„å­—ç¬¦ä¸²å­—æ®µå°†é»˜è®¤è®¾ç½®ä¸ºå…¨æ–‡stringå­—æ®µå¹¶ä½¿ç”¨æ ‡å‡†åˆ†æå™¨ï¼ˆstandardï¼‰åˆ†æã€‚ä¸ºäº†ä½¿ç”¨æ›´é€‚åˆçš„åˆ†æå™¨æˆ–è€…ä¸åšä»»ä½•å¤„ç†ï¼Œåˆ™éœ€è¦ä½¿ç”¨æ˜ å°„ï¼ˆmappingï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹å‰æåˆ°æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼ˆtypeï¼‰ï¼Œæ¯ä¸ªç±»å‹éƒ½æœ‰ä¸€ä¸ªæ˜ å°„ï¼ˆmappin
      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="ElasticSearch" scheme="https://theembers.github.io/categories/dev/ElasticSearch/"/>
    
    
      <category term="ElasticSearch" scheme="https://theembers.github.io/tags/ElasticSearch/"/>
    
  </entry>
  
  <entry>
    <title>MySQL[3]-æ”¶è—ï¼šä¸çŸ¥é“æ˜¯å“ªé‡Œæ¥çš„MySQLä¼˜åŒ–å¯¼å›¾</title>
    <link href="https://theembers.github.io/2019/07/09/db-5/"/>
    <id>https://theembers.github.io/2019/07/09/db-5/</id>
    <published>2019-07-09T08:15:29.000Z</published>
    <updated>2020-03-05T02:50:57.359Z</updated>
    
    <content type="html"><![CDATA[<p>å›¾æ˜¯é«˜æ¸…çš„ è‡ªå·±è½¬å­˜çœ‹å§~</p><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190709161458.jpg" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å›¾æ˜¯é«˜æ¸…çš„ è‡ªå·±è½¬å­˜çœ‹å§~&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190709161458.jpg&quot; alt&gt;&lt;/p&gt;

      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="database" scheme="https://theembers.github.io/categories/dev/database/"/>
    
    
      <category term="mysql" scheme="https://theembers.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearch[6]-åˆ†æ(analysis)</title>
    <link href="https://theembers.github.io/2019/07/08/es-6/"/>
    <id>https://theembers.github.io/2019/07/08/es-6/</id>
    <published>2019-07-08T03:18:55.000Z</published>
    <updated>2020-03-05T02:50:57.362Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ†æå’Œåˆ†æå™¨"><a class="headerlink" href="#åˆ†æå’Œåˆ†æå™¨"></a> åˆ†æå’Œåˆ†æå™¨</h2><p>åˆ†æ(analysis)æ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼š</p><ol><li>æ ‡è®°åŒ–ä¸€ä¸ªæ–‡æœ¬å—ä¸ºé€‚ç”¨äºå€’æ’ç´¢å¼•å•ç‹¬çš„è¯(term)</li><li>æ ‡å‡†åŒ–è¿™äº›è¯ä¸ºæ ‡å‡†å½¢å¼ï¼Œæé«˜å®ƒä»¬çš„â€œå¯æœç´¢æ€§â€æˆ–â€œæŸ¥å…¨ç‡â€</li></ol><p>è¿™ä¸ªè¿‡ç¨‹ç”±åˆ†æå™¨å®Œæˆï¼Œä¸€ä¸ªåˆ†æå™¨åŒ…å«ï¼š</p><ul><li>å­—ç¬¦è¿‡æ»¤å™¨<br>é¦–å…ˆå­—ç¬¦ä¸²ç»è¿‡å­—ç¬¦ä¸²è¿‡æ»¤å™¨(character filter),ç”¨æ¥åœ¨æ ‡è®°åŒ–å‰å¤„ç†å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚å»é™¤HTMLæ ‡ç­¾æˆ–è€…è½¬æ¢â€œ&amp;â€ä¸ºâ€œandâ€</li><li>åˆ†è¯å™¨<br>åˆ†è¯å™¨(tokenizer)æ ¹æ®å†…å»ºçš„ç®—æ³•æœºåˆ¶å¯¹å­—ç¬¦ä¸²è¿›è¡Œè¯åˆ‡åˆ†ï¼Œå½¢æˆå•ç‹¬çš„è¯ã€‚</li><li>æ ‡è®°è¿‡æ»¤<br>æ ‡è®°è¿‡æ»¤(token filters)å¯ä»¥ä¿®æ”¹è¯ï¼ˆæ¯”å¦‚å¤§å°å†™è½¬æ¢ï¼‰ã€å»æ‰è¯ï¼ˆæ¯”å¦‚å»æ‰åœç”¨è¯â€œtheâ€â€œandâ€â€œaâ€ï¼‰ã€å¢åŠ è¯ï¼ˆæ¯”å¦‚åŒä¹‰è¯ï¼‰</li></ul><h3 id="å†…å»ºåˆ†æå™¨"><a class="headerlink" href="#å†…å»ºåˆ†æå™¨"></a> å†…å»ºåˆ†æå™¨</h3><p>å®ä¾‹æ–‡æœ¬ï¼š<code>&quot;Set the shape to semi-transparent by calling set_trans(5)&quot;</code></p><ul><li>æ ‡å‡†åˆ†æå™¨<br>å®ƒæ ¹æ®Unicode Consortiumçš„å®šä¹‰çš„å•è¯è¾¹ç•Œ(word boundaries)æ¥åˆ‡åˆ†æ–‡æœ¬ï¼Œç„¶åå»æ‰å¤§éƒ¨åˆ†æ ‡ç‚¹ç¬¦å·ã€‚æœ€åï¼ŒæŠŠæ‰€æœ‰è¯è½¬ä¸ºå°å†™ã€‚<br><code>set, the, shape, to, semi, transparent, by, calling, set_trans, 5</code></li><li>ç®€å•åˆ†æå™¨<br>å°†éå•ä¸ªå­—æ¯çš„æ–‡æœ¬åˆ‡åˆ†ï¼Œç„¶åæŠŠæ¯ä¸ªè¯è½¬ä¸ºå°å†™ã€‚<br><code>set, the, shape, to, semi, transparent, by, calling, set, trans</code></li><li>ç©ºæ ¼åˆ†æå™¨<br>ä¾æ®ç©ºæ ¼åˆ‡åˆ†æ–‡æœ¬ã€‚å®ƒä¸è½¬æ¢å°å†™ã€‚<br><code>Set, the, shape, to, semi-transparent, by, calling, set_trans(5)</code></li><li>è¯­è¨€åˆ†æå™¨<br>ç‰¹å®šè¯­è¨€åˆ†æå™¨é€‚ç”¨äºå¾ˆå¤šè¯­è¨€ã€‚å®ƒä»¬èƒ½å¤Ÿè€ƒè™‘åˆ°ç‰¹å®šè¯­è¨€çš„ç‰¹æ€§ã€‚<br>ä¾‹å¦‚ï¼Œ english åˆ†æå™¨è‡ªå¸¦ä¸€å¥—è‹±è¯­åœç”¨è¯åº“â€”â€”åƒ and æˆ– the è¿™äº›ä¸è¯­ä¹‰æ— å…³çš„é€šç”¨è¯ã€‚è¿™äº›è¯è¢«ç§»é™¤åï¼Œå› ä¸ºè¯­æ³•è§„åˆ™çš„å­˜åœ¨ï¼Œè‹±è¯­å•è¯çš„ä¸»ä½“å«ä¹‰ä¾æ—§èƒ½è¢«ç†è§£ã€‚<br><code>set, shape, semi, transpar, call, set_tran, 5</code><br><em>æ³¨æ„ â€œtransparentâ€ ã€ â€œcallingâ€ å’Œ â€œset_transâ€ æ˜¯å¦‚ä½•è½¬ä¸ºè¯å¹²çš„ã€‚</em></li></ul><blockquote><p>å½“æˆ‘ä»¬ç´¢å¼•(index)ä¸€ä¸ªæ–‡æ¡£ï¼Œå…¨æ–‡å­—æ®µä¼šè¢«åˆ†æä¸ºå•ç‹¬çš„è¯æ¥åˆ›å»ºå€’æ’ç´¢å¼•ã€‚ä¸è¿‡ï¼Œå½“æˆ‘ä»¬åœ¨å…¨æ–‡å­—æ®µæœç´¢(search)æ—¶ï¼Œæˆ‘ä»¬è¦è®©æŸ¥è¯¢å­—ç¬¦ä¸²ç»è¿‡åŒæ ·çš„åˆ†ææµç¨‹å¤„ç†ï¼Œä»¥ç¡®ä¿è¿™äº›è¯åœ¨ç´¢å¼•ä¸­å­˜åœ¨ã€‚<br>å…¨æ–‡æŸ¥è¯¢æˆ‘ä»¬å°†åœ¨ç¨åè®¨è®ºï¼Œç†è§£æ¯ä¸ªå­—æ®µæ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Œè¿™æ ·æ‰å¯ä»¥è®©å®ƒä»¬åšæ­£ç¡®çš„äº‹ï¼š<br>å½“ä½ æŸ¥è¯¢å…¨æ–‡(full text)å­—æ®µï¼ŒæŸ¥è¯¢å°†ä½¿ç”¨ç›¸åŒçš„åˆ†æå™¨æ¥åˆ†ææŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œä»¥äº§ç”Ÿæ­£ç¡®çš„è¯åˆ—è¡¨ã€‚<br>å½“ä½ æŸ¥è¯¢ä¸€ä¸ªç¡®åˆ‡å€¼(exact value)å­—æ®µï¼ŒæŸ¥è¯¢å°†ä¸åˆ†ææŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä½ å¯ä»¥è‡ªå·±æŒ‡å®šã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;åˆ†æå’Œåˆ†æå™¨&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#åˆ†æå’Œåˆ†æå™¨&quot;&gt;&lt;/a&gt; åˆ†æå’Œåˆ†æå™¨&lt;/h2&gt;
&lt;p&gt;åˆ†æ(analysis)æ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ ‡è®°åŒ–ä¸€ä¸ªæ–‡æœ¬å—ä¸ºé€‚ç”¨äºå€’æ’ç´¢å¼•å•ç‹¬çš„è¯(term)&lt;/li&gt;
&lt;
      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="ElasticSearch" scheme="https://theembers.github.io/categories/dev/ElasticSearch/"/>
    
    
      <category term="ElasticSearch" scheme="https://theembers.github.io/tags/ElasticSearch/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearch[5]-æ­£ç‰‡ï¼šæ˜ å°„(mapping)&amp;åˆ†è¯(analysis)å‰ç½®</title>
    <link href="https://theembers.github.io/2019/07/08/es-5/"/>
    <id>https://theembers.github.io/2019/07/08/es-5/</id>
    <published>2019-07-08T01:35:28.000Z</published>
    <updated>2020-03-05T02:50:57.362Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®šä¹‰"><a class="headerlink" href="#å®šä¹‰"></a> å®šä¹‰</h2><ul><li>æ˜ å°„(mapping)æœºåˆ¶ç”¨äºè¿›è¡Œå­—æ®µç±»å‹ç¡®è®¤ï¼Œå°†æ¯ä¸ªå­—æ®µåŒ¹é…ä¸ºä¸€ç§ç¡®å®šçš„æ•°æ®ç±»å‹(string,number,booleans,dateç­‰)ã€‚</li><li>åˆ†æ(analysis)æœºåˆ¶ç”¨äºè¿›è¡Œå…¨æ–‡æ–‡æœ¬(Full Text)çš„åˆ†è¯ï¼Œä»¥å»ºç«‹ä¾›æœç´¢ç”¨çš„åå‘ç´¢å¼•ã€‚</li></ul><h2 id="æ˜ å°„-åˆ†è¯"><a class="headerlink" href="#æ˜ å°„-åˆ†è¯"></a> æ˜ å°„ &amp; åˆ†è¯</h2><p>ElasticSearch ä¼šå¯¹æ¯ä¸€ä¸ªtypeè¿›è¡Œmappingï¼šé€šè¿‡ä»¥ä¸‹æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">GET /&#123;index&#125;/_mapping/&#123;type&#125;/</span><br><span class="line"></span><br><span class="line"># è¿”å›(ç¤ºä¾‹)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"gb"</span>: &#123;</span><br><span class="line">    <span class="attr">"mappings"</span>: &#123;</span><br><span class="line">      <span class="attr">"tweet"</span>: &#123;</span><br><span class="line">        <span class="attr">"properties"</span>: &#123;</span><br><span class="line">          <span class="attr">"date"</span>: &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"date"</span>,</span><br><span class="line">            <span class="attr">"format"</span>: <span class="string">"dateOptionalTime"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"name"</span>: &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"tweet"</span>: &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">"user_id"</span>: &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡º ESå¯¹æ¯ä¸€ä¸ªå­—æ®µè¿›è¡ŒçŒœæƒ³åŠ¨æ€ç”Ÿæˆäº†å­—æ®µå’Œç±»å‹çš„æ˜ å°„å…³ç³»ã€‚æ¯”å¦‚dateå­—æ®µçš„ç±»å‹dateï¼Œè€Œåœ¨_allå­—æ®µä¸­dateçš„å€¼åˆ™æ˜¯stringã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå‡å¦‚ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è¿›è¡Œæ£€ç´¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /_search?q=2019</span><br><span class="line">GET /_search?q=date:2019</span><br></pre></td></tr></table></figure><p>å°†ä¼šå¾—åˆ°ä¸ä¸€æ ·çš„ç»“æœï¼Œå› ä¸ºdateç±»å‹å’Œstringç±»å‹çš„ç´¢å¼•æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œç´¢å¼•ä¼šå¯¼è‡´æŸ¥è¯¢ç»“æœä¸ä¸€è‡´ã€‚</p><blockquote><p>ä½ ä¼šæœŸæœ›æ¯ä¸€ç§æ ¸å¿ƒæ•°æ®ç±»å‹(strings, numbers, booleansåŠdates)ä»¥ä¸åŒçš„æ–¹å¼è¿›è¡Œç´¢å¼•ï¼Œè€Œè¿™ç‚¹ä¹Ÿæ˜¯ç°å®ï¼šåœ¨Elasticsearchä¸­ä»–ä»¬æ˜¯è¢«åŒºåˆ«å¯¹å¾…çš„ã€‚<br>ä½†æ˜¯æ›´å¤§çš„åŒºåˆ«åœ¨äºç¡®åˆ‡å€¼(exact values)(æ¯”å¦‚ string ç±»å‹)åŠå…¨æ–‡æ–‡æœ¬(full text)ä¹‹é—´ã€‚<br>è¿™ä¸¤è€…çš„åŒºåˆ«æ‰çœŸçš„å¾ˆé‡è¦ - è¿™æ˜¯åŒºåˆ†æœç´¢å¼•æ“å’Œå…¶ä»–æ•°æ®åº“çš„æ ¹æœ¬å·®å¼‚ã€‚<br>â€”â€”ã€ŠESæƒå¨æŒ‡å—ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰ã€‹</p></blockquote><h2 id="ç¡®åˆ‡å€¼exact-values-å…¨æ–‡æ–‡æœ¬full-text"><a class="headerlink" href="#ç¡®åˆ‡å€¼exact-values-å…¨æ–‡æ–‡æœ¬full-text"></a> ç¡®åˆ‡å€¼(Exact values) &amp; å…¨æ–‡æ–‡æœ¬(Full text)</h2><p>Elasticsearch ä¸­çš„æ•°æ®å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šç¡®åˆ‡å€¼ åŠ å…¨æ–‡æ–‡æœ¬ã€‚</p><p>ç¡®åˆ‡å€¼ ç±»ä¼¼äºä¸€ç§ç»“æ„åŒ–çš„æ•°æ®å€¼ï¼Œï¼ˆæ˜¯ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆï¼Œç±»ä¼¼äºequalsï¼‰ï¼Œæ‰€ä»¥çš„å¤§å°å†™åŒºåˆ«ã€å‰ç¼€ä¸€è‡´ç­‰å½¢å¼çš„&quot;ç­‰ä»·&quot;éƒ½æ˜¯ä¸æˆç«‹äº†ã€‚<br>è€Œ å…¨æ–‡æœ¬ åˆ™æ˜¯ä¸€ç§ç±»ä¼¼ä¸ éç»“æ„åŒ–çš„æ•°æ®å€¼ã€‚ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ç§é«˜åº¦ç»“æ„åŒ–çš„æ•°æ®ï¼‰<br>å› æ­¤ï¼Œå¯¹äºç¡®åˆ‡å€¼æ¥è¯´ï¼Œä»–çš„æŸ¥è¯¢æ—¶å¾ˆç®€å•çš„ï¼Œè¦ä¹ˆåŒ¹é…ï¼Œè¦ä¹ˆä¸åŒ¹é…ã€‚ä¸ä¼šåƒå…¨æ–‡æœ¬ä¸€æ ·éœ€è¦å¯¹å…¶è¿›è¡Œè¯­è¨€çš„åˆ†æä»¥åŠç›¸å…³åº¦é«˜ä½æ¥è¿›è¡Œè¯„åˆ¤ã€‚<br>ä¸ºæ­¤ï¼ŒElasticSearch ä½¿ç”¨äº†å…¨æ–‡æœ¬åˆ†æï¼ˆanalyzesï¼‰ï¼Œç„¶åå»ºç«‹ <strong>å€’æ’ç´¢å¼•</strong>ã€‚</p><h2 id="å€’æ’ç´¢å¼•"><a class="headerlink" href="#å€’æ’ç´¢å¼•"></a> å€’æ’ç´¢å¼•</h2><p>å€’æ’ç´¢å¼•ç”±æ–‡æ¡£ä¸­å‡ºç°çš„å”¯ä¸€çš„å•è¯åˆ—è¡¨ï¼Œä»¥åŠå¯¹äºæ¯ä¸€ä¸ªå•è¯åœ¨æ–‡æ¡£ä¸­çš„ä½ç½®ç»„æˆã€‚</p><p>å®ä¾‹ï¼š<br>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–‡æ¡£ï¼Œæ¯ä¸ªæ–‡æ¡£ content å­—æ®µåŒ…å«ï¼š</p><ol><li>The quick brown fox jumped over the lazy dog</li><li>Quick brown foxes leap over lazy dogs in summer<br>ä¸ºäº†åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ‡åˆ†æ¯ä¸ªæ–‡æ¡£çš„ content å­—æ®µä¸ºå•ç‹¬çš„å•è¯ï¼ˆæˆ‘ä»¬æŠŠå®ƒä»¬å«åšè¯(terms)æˆ–è€…è¡¨å¾(tokens)ï¼‰ï¼ˆè¯‘è€…æ³¨ï¼šå…³äº terms å’Œ tokens çš„ç¿»è¯‘æ¯”è¾ƒç”Ÿç¡¬ï¼Œåªéœ€çŸ¥é“è¯­å¥åˆ†è¯åçš„ä¸ªä½“å«åšè¿™ä¸¤ä¸ªã€‚ï¼‰ï¼ŒæŠŠæ‰€æœ‰çš„å”¯ä¸€è¯æ”¾å…¥åˆ—è¡¨å¹¶æ’åºï¼Œç»“æœæ˜¯è¿™ä¸ªæ ·å­çš„ï¼š<br><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190708104904.png" alt><br>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æœç´¢ â€œquick brownâ€ ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°æ¯ä¸ªè¯åœ¨å“ªä¸ªæ–‡æ¡£ä¸­å‡ºç°å³å¯ï¼š<br><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190708104931.png" alt></li></ol><p>ä½†æ˜¯è¿™é‡Œä¾ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œä¹‹å‰è¯´çš„å…¨æ–‡æœç´¢åº”å½“æ˜¯ä¸€ç§ç¬¦åˆè¯­ä¹‰çš„ï¼Œæ‰€ä»¥å¯¹äºå…¶ä¸­ä¸€äº›å•è¯çš„è¯­ä¹‰ã€è¯æ€§çš„ç›¸ä¼¼åº¦è¿›è¡Œæ¯”è¾ƒã€‚æ‰€ä»¥è€ƒè™‘åˆ°è¿™äº›å› ç´ ä¹‹åçš„ç›¸ä¼¼åº¦æ¯”è¾ƒå°±ä¸å†é‚£ä¹ˆå•çº¯äº†ã€‚<br>æ­¤æ—¶å°±éœ€è¦ä¸€ä¸ªæ ‡å‡†åŒ–çš„è¿‡ç¨‹ï¼š<strong>åˆ†è¯ï¼ˆ(analysis)ï¼‰</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å®šä¹‰&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#å®šä¹‰&quot;&gt;&lt;/a&gt; å®šä¹‰&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ˜ å°„(mapping)æœºåˆ¶ç”¨äºè¿›è¡Œå­—æ®µç±»å‹ç¡®è®¤ï¼Œå°†æ¯ä¸ªå­—æ®µåŒ¹é…ä¸ºä¸€ç§ç¡®å®šçš„æ•°æ®ç±»å‹(string,number,booleans,dateç­‰)ã€‚&lt;
      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="ElasticSearch" scheme="https://theembers.github.io/categories/dev/ElasticSearch/"/>
    
    
      <category term="ElasticSearch" scheme="https://theembers.github.io/tags/ElasticSearch/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearch[4]-æ­£ç‰‡ï¼šæœç´¢</title>
    <link href="https://theembers.github.io/2019/07/03/es-4/"/>
    <id>https://theembers.github.io/2019/07/03/es-4/</id>
    <published>2019-07-03T01:44:54.000Z</published>
    <updated>2020-03-05T02:50:57.361Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ˜ å°„-åˆ†æ-é¢†åŸŸç‰¹å®šè¯­è¨€æŸ¥è¯¢dsl"><a class="headerlink" href="#æ˜ å°„-åˆ†æ-é¢†åŸŸç‰¹å®šè¯­è¨€æŸ¥è¯¢dsl"></a> æ˜ å°„ &amp; åˆ†æ &amp; é¢†åŸŸç‰¹å®šè¯­è¨€æŸ¥è¯¢ï¼ˆdslï¼‰</h2><table><thead><tr><th style="text-align:left">æ¦‚å¿µ</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left">æ˜ å°„(Mapping)</td><td style="text-align:left">æ•°æ®åœ¨æ¯ä¸ªå­—æ®µä¸­çš„è§£é‡Šè¯´æ˜</td></tr><tr><td style="text-align:left">åˆ†æ(Analysis)</td><td style="text-align:left">å…¨æ–‡æ˜¯å¦‚ä½•å¤„ç†çš„å¯ä»¥è¢«æœç´¢çš„</td></tr><tr><td style="text-align:left">é¢†åŸŸç‰¹å®šè¯­è¨€æŸ¥è¯¢(Query DSL)</td><td style="text-align:left">Elasticsearchä½¿ç”¨çš„çµæ´»çš„ã€å¼ºå¤§çš„æŸ¥è¯¢è¯­è¨€</td></tr></tbody></table><h2 id="å¤šç´¢å¼•-å¤šç±»åˆ«"><a class="headerlink" href="#å¤šç´¢å¼•-å¤šç±»åˆ«"></a> å¤šç´¢å¼• &amp; å¤šç±»åˆ«</h2><p>é€šè¿‡é™åˆ¶æœç´¢çš„ä¸åŒç´¢å¼•æˆ–ç±»å‹ï¼Œå¯ä»¥åœ¨é›†ç¾¤ä¸­è·¨æ‰€æœ‰æ–‡æ¡£æœç´¢ã€‚</p><p>æŒ‡å®šç´¢å¼•çš„æœç´¢ï¼Œå¯ä»¥æ˜¯é€šé…ç¬¦çš„å½¢å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªç´¢å¼•ï¼š</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/&#123;index&#125;,&#123;index&#125;/&#123;type&#125;,&#123;type&#125;/_search</span><br><span class="line"></span><br><span class="line"># é€šé…ç¬¦</span><br><span class="line">/g*,u*/x*,y*/_search</span><br></pre></td></tr></table></figure><h2 id="åˆ†é¡µ"><a class="headerlink" href="#åˆ†é¡µ"></a> åˆ†é¡µ</h2><p>ESæ¥å— from å’Œ size å‚æ•°è¿›è¡Œåˆ†é¡µæŸ¥è¯¢ï¼š</p><ul><li>from è·³è¿‡å¼€å§‹çš„ç»“æœæ•° é»˜è®¤0</li><li>size ç»“æœæ•° é»˜è®¤10</li></ul><p>ä¾‹å¦‚ï¼š<code>/_search?from=10&amp;size=20</code></p><h3 id="åˆ†é¡µæœç´¢æ–¹å¼"><a class="headerlink" href="#åˆ†é¡µæœç´¢æ–¹å¼"></a> åˆ†é¡µæœç´¢æ–¹å¼</h3><p>ESçš„æœç´¢å¯èƒ½ä¼šæ¶‰åŠåˆ°å¤šä¸ªåˆ†ç‰‡ï¼ŒElasticsearch ä¼šè½¬å‘æœç´¢è¯·æ±‚åˆ°è¿™ä¸ªç´¢å¼•çš„ä¸»åˆ†ç‰‡æˆ–æ¯ä¸ªåˆ†ç‰‡çš„å¤<br>åˆ¶åˆ†ç‰‡ä¸Šï¼Œç„¶åèšé›†æ¯ä¸ªåˆ†ç‰‡çš„ç»“æœã€‚å‡å¦‚æœç´¢çš„sizeæ˜¯10ï¼Œé‚£ä¹ˆESä¼šå»æ£€ç´¢æ¯ä¸ªåˆ†ç‰‡ä¸Šå„è‡ªç¬¦åˆæ¡ä»¶çš„æ•°æ®è¿›è¡Œæ’åºï¼Œå¹¶è¿”å›10ä¸ªç»“æœï¼Œæœ€åä¼šåœ¨è¯·æ±‚èŠ‚ç‚¹ä¸Šå¯¹æ‰€æœ‰çš„ç»“æœè¿›è¡Œæ’åºå¹¶è¿”å›ï¼Œä»¥æ­¤ä¿è¯æœ€ç»ˆç»“æœçš„é¡ºåºæ­£ç¡®ã€‚</p><blockquote><p>åœ¨é›†ç¾¤ç³»ç»Ÿä¸­æ·±åº¦åˆ†é¡µ<br>ä¸ºäº†ç†è§£ä¸ºä»€ä¹ˆæ·±åº¦åˆ†é¡µæ˜¯æœ‰é—®é¢˜çš„ï¼Œå‡è®¾åœ¨ä¸€ä¸ªæœ‰5ä¸ªä¸»åˆ†ç‰‡çš„ç´¢å¼•ä¸­æœç´¢ã€‚å½“è¯·æ±‚ç»“æœçš„ç¬¬ä¸€é¡µï¼ˆç»“æœ1åˆ°10ï¼‰æ—¶ï¼Œæ¯ä¸ªåˆ†ç‰‡äº§ç”Ÿè‡ªå·±æœ€é¡¶ç«¯10ä¸ªç»“æœç„¶åè¿”å›å®ƒä»¬ç»™è¯·æ±‚èŠ‚ç‚¹(requesting node)ï¼Œå®ƒå†æ’åºè¿™æ‰€æœ‰çš„50ä¸ªç»“æœä»¥é€‰å‡ºé¡¶ç«¯çš„10ä¸ªç»“æœã€‚ç°åœ¨å‡è®¾è¯·æ±‚ç¬¬1000é¡µâ€”â€”ç»“æœ10001åˆ°10010ã€‚å·¥ä½œæ–¹å¼éƒ½ç›¸åŒï¼Œä¸åŒçš„æ˜¯æ¯ä¸ªåˆ†ç‰‡éƒ½å¿…é¡»äº§ç”Ÿé¡¶ç«¯çš„10010ä¸ªç»“æœã€‚ç„¶åè¯·æ±‚èŠ‚ç‚¹æ’åºè¿™50050ä¸ªç»“æœå¹¶ä¸¢å¼ƒ50040ä¸ªï¼å¯ä»¥çœ‹åˆ°åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ’åºç»“æœçš„èŠ±è´¹éšç€åˆ†é¡µçš„æ·±å…¥è€Œæˆå€å¢é•¿ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç½‘ç»œæœç´¢å¼•æ“ä¸­ä»»ä½•è¯­å¥ä¸èƒ½è¿”å›å¤šäº1000ä¸ªç»“æœçš„åŸå› ã€‚</p></blockquote><h2 id="ç®€æ˜“æœç´¢-å¤æ‚æœç´¢"><a class="headerlink" href="#ç®€æ˜“æœç´¢-å¤æ‚æœç´¢"></a> ç®€æ˜“æœç´¢ &amp; å¤æ‚æœç´¢</h2><p>search APIæœ‰ä¸¤ç§è¡¨å•ï¼š</p><ul><li>ä¸€ç§æ˜¯â€œç®€æ˜“ç‰ˆâ€çš„æŸ¥è¯¢å­—ç¬¦ä¸²(query string)å°†æ‰€æœ‰å‚æ•°é€šè¿‡æŸ¥è¯¢å­—ç¬¦ä¸²å®šä¹‰</li><li>å¦ä¸€ç§ç‰ˆæœ¬ä½¿ç”¨JSONå®Œæ•´çš„è¡¨ç¤ºè¯·æ±‚ä½“(request body)ï¼Œè¿™ç§å¯Œæœç´¢è¯­è¨€å«åšç»“æ„åŒ–æŸ¥è¯¢è¯­å¥ï¼ˆDSLï¼‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥è¯¢ typeç±»å‹çš„â€˜nameâ€™å­—æ®µä¸ºtomçš„æ–‡æ¡£</span><br><span class="line">GET /_all/&#123;type&#125;/_search?q=name:tom</span><br><span class="line"></span><br><span class="line"># åŒ…å«ä¸ä¸åŒ…å«ï¼šâ€˜+â€™ï¼Œâ€˜-â€™</span><br><span class="line">GET /_all/&#123;type&#125;/_search?q=+name:tom-name:jerry</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># name åŒ…å« â€˜tomâ€™æˆ–â€˜jerryâ€™</span><br><span class="line"># date æ™šäº 1993-01-20</span><br><span class="line">q=+name:(tom,jerry)+date:&gt;1993-01-20</span><br></pre></td></tr></table></figure><blockquote><p>è¿™è¿™æœç´¢æ–¹å¼æœç´¢ä¸ä¾¿ä¹‹å¤„åœ¨äºï¼šå®¹æ˜“å‡ºç°è¯­æ³•é”™è¯¯è€Œå¯¼è‡´è¿”å›é”™è¯¯çš„æœç´¢ç»“æœä»¥åŠæ…¢æŸ¥è¯¢ã€‚<br>å› æ­¤ï¼Œä¸€èˆ¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨è¯·æ±‚ä½“æœç´¢APIã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;æ˜ å°„-åˆ†æ-é¢†åŸŸç‰¹å®šè¯­è¨€æŸ¥è¯¢dsl&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#æ˜ å°„-åˆ†æ-é¢†åŸŸç‰¹å®šè¯­è¨€æŸ¥è¯¢dsl&quot;&gt;&lt;/a&gt; æ˜ å°„ &amp;amp; åˆ†æ &amp;amp; é¢†åŸŸç‰¹å®šè¯­è¨€æŸ¥è¯¢ï¼ˆdslï¼‰&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;t
      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="ElasticSearch" scheme="https://theembers.github.io/categories/dev/ElasticSearch/"/>
    
    
      <category term="ElasticSearch" scheme="https://theembers.github.io/tags/ElasticSearch/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearch[3]-åˆ†å¸ƒå¼ä¸­CRUDæœºåˆ¶</title>
    <link href="https://theembers.github.io/2019/07/02/es-3/"/>
    <id>https://theembers.github.io/2019/07/02/es-3/</id>
    <published>2019-07-02T01:44:06.000Z</published>
    <updated>2020-03-05T02:50:57.361Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ†ç‰‡è·¯ç”±"><a class="headerlink" href="#åˆ†ç‰‡è·¯ç”±"></a> åˆ†ç‰‡è·¯ç”±</h2><p>ESé€šè¿‡hashå–æ¨¡çš„ç®—æ³•æ¥åˆ†é…ç´¢å¼•æˆ–åˆ›å»ºä¸€ä¸ªæ–‡æ¡£è¯¥å¦‚ä½•å­˜å‚¨åœ¨å“ªä¸€ä¸ªåˆ†ç‰‡ä¸­ã€‚</p><p><code>shard = hash(routing) % number_of_primary_shards</code></p><p>routing å€¼æ˜¯ä¸€ä¸ªä»»æ„å­—ç¬¦ä¸²ï¼Œå®ƒé»˜è®¤æ˜¯ _id ä½†ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚routing å­—ç¬¦ä¸²é€šè¿‡å“ˆå¸Œå‡½æ•°ç”Ÿæˆä¸€ä¸ªæ•°å­—ï¼Œç„¶åé™¤ä»¥ä¸»åˆ‡ç‰‡çš„æ•°é‡å¾—åˆ°ä¸€ä¸ªä½™æ•°(remainder)ï¼Œä½™æ•°çš„èŒƒå›´æ°¸è¿œæ˜¯ 0 åˆ° number_of_primary_shards - 1 ï¼Œè¿™ä¸ªæ•°å­—å°±æ˜¯ç‰¹å®šæ–‡æ¡£æ‰€åœ¨çš„åˆ†ç‰‡ã€‚</p><blockquote><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¹‹å‰æ‰€è¯´çš„ ä¸»åˆ†ç‰‡åœ¨çš„æ•°é‡åªèƒ½åœ¨ç´¢å¼•åˆ›å»ºæ—¶å®šä¹‰ä¸”ä¸å¯ä¿®æ”¹ã€‚å¦‚æœä¿®æ”¹äº†é‚£ä¹ˆæ‰€æœ‰çš„è·¯ç”±å€¼å°†å¤±æ•ˆï¼Œæ–‡æ¡£è®²æ— æ³•æ‰¾åˆ°ã€‚é™¤éé‡æ„ç´¢å¼•ã€‚</p></blockquote><h2 id="ä¸»åˆ†ç‰‡ä¸å¤åˆ¶åˆ†ç‰‡çš„äº¤äº’"><a class="headerlink" href="#ä¸»åˆ†ç‰‡ä¸å¤åˆ¶åˆ†ç‰‡çš„äº¤äº’"></a> ä¸»åˆ†ç‰‡ä¸å¤åˆ¶åˆ†ç‰‡çš„äº¤äº’</h2><p>å‡è®¾æœ‰ä»¥ä¸‹ä¸‰ä¸ªnodeçš„é›†ç¾¤æ¨¡å¼ï¼š</p><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190702101230.png" alt></p><p>è¯·æ±‚å¯ä»¥å‘é€åˆ°é›†ç¾¤ä¸­çš„ä»»æ„ä¸€ä¸ªnodeä¸Šï¼Œæ¯ä¸ªnodeéƒ½æœ‰å¤„ç†è¯·æ±‚çš„èƒ½åŠ›ï¼Œå¹¶ä¸”æ¯ä¸ªnodeéƒ½çŸ¥é“ä»»æ„æ–‡æ¡£æ‰€åœ¨çš„nodeï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥å°†è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„nodeã€‚</p><blockquote><p>æ‰€ä»¥ï¼ŒåŸºäºä»¥ä¸Šçš„èƒ½åŠ›ï¼Œå¯ä»¥æŠŠè¯·æ±‚å¾ªç¯æˆ–è€…å…¶ä»–è´Ÿè½½å‡è¡¡çš„æ–¹å¼å¹³å‡å‘é€åˆ°æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šã€‚ä»¥å®ç°è´Ÿè½½ã€‚</p></blockquote><h2 id="crudæ–‡æ¡£"><a class="headerlink" href="#crudæ–‡æ¡£"></a> CRUDæ–‡æ¡£</h2><p>å†™æ“ä½œ(æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤)å¿…é¡»åœ¨ä¸»åˆ†ç‰‡ä¸Šå®Œæˆæ‰èƒ½åŒæ­¥åˆ°ç›¸å…³çš„å¤åˆ¶åˆ†ç‰‡ä¸Šã€‚</p><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190702140030.png" alt></p><ol><li>å®¢æˆ·ç«¯è¯·æ±‚å‘é€åˆ°node1</li><li>node1 æ ¹æ® _idç¡®å®šæ–‡æ¡£å±äºshard0ï¼Œè½¬å‘è¯·æ±‚åˆ°node3</li><li>node3å¤„ç†è¯·æ±‚åè½¬å‘åˆ°node1å’Œnode2ä¸Šçš„å¤åˆ¶åˆ†ç‰‡ï¼Œå½“æ‰€æœ‰å¤åˆ¶åˆ†ç‰‡æŠ¥å‘ŠæˆåŠŸï¼Œnode3æŠ¥å‘ŠæˆåŠŸç»™node1(è¯·æ±‚æ¥å—èŠ‚ç‚¹)ï¼Œnode1æŠ¥å‘Šç»™å®¢æˆ·ç«¯</li></ol><p>æœ‰å¾ˆå¤šå¯é€‰çš„è¯·æ±‚å‚æ•°å…è®¸ä½ æ›´æ”¹è¿™ä¸€è¿‡ç¨‹ï¼š</p><ul><li>replication<br>é»˜è®¤replication=syncï¼Œå³å¤åˆ¶å®Œæˆåæ‰è¿”å›å®¢æˆ·ç«¯æŠ¥å‘Šï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ä¸º async è¿™æ—¶å®¢æˆ·ç«¯æ˜¯æ— æ³•ç¡®è®¤æ˜¯å¦å®Œæˆå¤åˆ¶çš„</li><li>consistency<br>é»˜è®¤ä¸»åˆ†ç‰‡åœ¨å°è¯•å†™å…¥æ—¶éœ€è¦è§„å®šæ•°é‡(quorum)æˆ–è¿‡åŠçš„åˆ†ç‰‡(å¯ä»¥æ˜¯ä¸»èŠ‚ç‚¹æˆ–å¤åˆ¶èŠ‚ç‚¹)å¯ç”¨ã€‚è¿™æ˜¯é˜²æ­¢æ•°æ®è¢«å†™å…¥åˆ°é”™çš„ç½‘ç»œåˆ†åŒºã€‚<br><code>int((primary + number_of_replicas) / 2) + 1</code><br>consistency å…è®¸çš„å€¼ä¸º one ï¼ˆåªæœ‰ä¸€ä¸ªä¸»åˆ†ç‰‡ï¼‰ï¼Œ all ï¼ˆæ‰€æœ‰ä¸»åˆ†ç‰‡å’Œå¤åˆ¶åˆ†ç‰‡ï¼‰æˆ–è€…é»˜è®¤çš„ quorum æˆ–è¿‡åŠåˆ†ç‰‡ã€‚</li><li>timeout</li></ul><h2 id="æ£€ç´¢æ–‡æ¡£"><a class="headerlink" href="#æ£€ç´¢æ–‡æ¡£"></a> æ£€ç´¢æ–‡æ¡£</h2><p>æ–‡æ¡£èƒ½å¤Ÿä»ä¸»åˆ†ç‰‡æˆ–ä»»æ„ä¸€ä¸ªå¤åˆ¶åˆ†ç‰‡è¢«æ£€ç´¢ã€‚</p><p><img src="https://image-1257148187.cos.ap-chengdu.myqcloud.com/picgo_img/20190702141657.png" alt></p><ol><li>å®¢æˆ·ç«¯ç»™ node1 å‘é€getè¯·æ±‚ã€‚</li><li>èŠ‚ç‚¹ä½¿ç”¨æ–‡æ¡£çš„ _id ç¡®å®šæ–‡æ¡£å±äºåˆ†ç‰‡0 ã€‚åˆ†ç‰‡0 å¯¹åº”çš„å¤åˆ¶åˆ†ç‰‡åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰ã€‚æ­¤æ—¶ï¼Œå®ƒè½¬å‘è¯·æ±‚åˆ° node2 ã€‚</li><li>node2 è¿”å›æ–‡æ¡£(document)ç»™ node1 ç„¶åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol><p>ä¸ºäº†è´Ÿè½½å‡è¡¡ï¼Œæ¥å—è¯·æ±‚çš„nodeä¾ç„¶ä¼šå¾ªç¯æŠŠè¯·æ±‚è½¬å‘åˆ°å…¶ä»–åˆ†ç‰‡ä¸Š(å³ä¾¿å½“å‰èŠ‚ç‚¹å·²ç»å­˜åœ¨è¯¥æ–‡æ¡£çš„åˆ†ç‰‡)ã€‚<br><strong>å¦‚æœè¯·æ±‚åœ¨å¤åˆ¶åˆ†ç‰‡ä¸­æœªæŸ¥åˆ°æ–‡æ¡£ï¼Œåˆ™ä¼šå†è½¬å‘åˆ°ä¸»åˆ†ç‰‡æ‰€åœ¨çš„èŠ‚ç‚¹è¿›è¡ŒæŸ¥è¯¢ã€‚è¿™æ ·å°±é¿å…äº†å‡ºç°æ‰€è¦æŸ¥è¯¢çš„æ•°æ®åœ¨ä¸»åˆ†ç‰‡å°šæœªæ¥å¾—åŠå¤åˆ¶åˆ°å¤åˆ¶åˆ†ç‰‡è€Œå¯¼è‡´çš„ä¸€è‡´æ€§é—®é¢˜ã€‚</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;åˆ†ç‰‡è·¯ç”±&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#åˆ†ç‰‡è·¯ç”±&quot;&gt;&lt;/a&gt; åˆ†ç‰‡è·¯ç”±&lt;/h2&gt;
&lt;p&gt;ESé€šè¿‡hashå–æ¨¡çš„ç®—æ³•æ¥åˆ†é…ç´¢å¼•æˆ–åˆ›å»ºä¸€ä¸ªæ–‡æ¡£è¯¥å¦‚ä½•å­˜å‚¨åœ¨å“ªä¸€ä¸ªåˆ†ç‰‡ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;shard = hash(routing)
      
    
    </summary>
    
      <category term="dev" scheme="https://theembers.github.io/categories/dev/"/>
    
      <category term="ElasticSearch" scheme="https://theembers.github.io/categories/dev/ElasticSearch/"/>
    
    
      <category term="ElasticSearch" scheme="https://theembers.github.io/tags/ElasticSearch/"/>
    
  </entry>
  
</feed>
